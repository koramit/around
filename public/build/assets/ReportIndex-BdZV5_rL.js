import{k as S,r as V,i as T,h as a,j,d as s,e as f,b as o,m as D,c as i,g as q,B as N,n as O,o as H,F as c,l as k,u as L,T as F,t as p,G as B,f as U}from"./app-EyHLH-0t.js";import{u as P}from"./useConfirmForm-B9-ne3XH.js";import{_ as I}from"./ActionColumn-CIX4xGld.js";import E from"./ConfirmFormComposable-DJUrQ6rF.js";import{M}from"./ModalDialog-CLl09q7z.js";import{_}from"./FormInput-CnL0NmD-.js";import{_ as G}from"./FormDatetime-CVNQBJkd.js";import{_ as K}from"./FormRadio-HnCnqo2z.js";import{_ as A}from"./FormCheckbox-CcUyRibE.js";import{_ as z}from"./PaginationNav-BZrcEshl.js";import{_ as J}from"./SearchIndex-DfTOsmA1.js";import{I as Q,_ as W}from"./IconDoubleDown-6u6_t6O1.js";import{_ as R}from"./NoteStatusBadge-0DK3ETGz.js";import"./SpinnerButton-Cspc9jAI.js";import"./pickBy-DHmAnep_.js";import"./throttle-DA-PtxR0.js";const X={class:"py-4 my-2 md:py-6 md:my-4 border-t border-b border-accent-darker"},Y={key:0,class:"space-y-2"},Z={key:0,class:"space-y-2"},ee={key:1,class:"space-y-2 md:space-y-0 md:grid grid-cols-2 gap-4"},te={class:"sm:grid-cols-2 gap-x-2"},ne={class:"flex justify-end items-center"},oe=["disabled"],se={__name:"CreateForm",props:{serviceEndpoint:{type:String,required:!0}},emits:["confirmed"],setup(u,{expose:y,emit:b}){const v=u,g=b,t=S({patient_type:null,hn:null,patient_name:null,patient_error:null,date_serum:null,donor_hn:null,donor_name:null,donor_error:null,request_hla:!1,request_cxm:!1,request_addition_tissue:!1}),d=V(null),m=V(null),h=l=>{let e;l==="recipient"?(e=t.hn,t.patient_name=null,t.patient_error=null):(e=t.donor_hn,t.donor_name=null,t.donor_error=null),window.axios.post(v.serviceEndpoint,{hn:e}).then(n=>{n.data.found?l==="recipient"?t.patient_name=n.data.name:t.donor_name=n.data.name:l==="recipient"?t.patient_error=n.data.message:t.donor_error=n.data.message}).catch(n=>console.log(n))},w=()=>{d.value.open()},C=()=>{O(()=>m.value.focus())},$=T(()=>t.patient_type?t.patient_type==="Patient"?!t.patient_name||!t.date_serum||!t.request_cxm&&!t.request_hla&&!t.request_addition_tissue:!t.patient_name||!t.date_serum||!t.request_cxm&&!t.request_hla&&!t.request_addition_tissue||!t.donor_name:!0),r=()=>{d.value.close(),g("confirmed",{...t})};return y({open:w}),(l,e)=>(a(),j(N,{to:"body"},[s(M,{ref_key:"modal",ref:d,"width-mode":"form-cols-1",onClosed:e[14]||(e[14]=n=>Object.keys(t).map(x=>t[x]=null))},{header:f(()=>e[15]||(e[15]=[o("div",{class:"font-semibold text-complement"}," HLA typing for KT Report ",-1)])),body:f(()=>[o("div",X,[e[17]||(e[17]=o("label",{class:"form-label"},"patient type :",-1)),s(K,{name:"patient_type",class:"md:grid grid-cols-2 gap-4",modelValue:t.patient_type,"onUpdate:modelValue":e[0]||(e[0]=n=>t.patient_type=n),options:["Patient","Recipient with LD"],onAutosave:C},null,8,["modelValue"]),s(D,{name:"slide-fade"},{default:f(()=>[t.patient_type?(a(),i("div",Y,[t.patient_type==="Patient"?(a(),i("div",Z,[s(_,{label:"patient hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":e[1]||(e[1]=n=>t.hn=n),type:"tel",error:t.patient_error,ref_key:"hnInput",ref:m,onAutosave:e[2]||(e[2]=n=>h("recipient"))},null,8,["modelValue","error"]),s(_,{label:"patient name",name:"patient_name",modelValue:t.patient_name,"onUpdate:modelValue":e[3]||(e[3]=n=>t.patient_name=n),readonly:""},null,8,["modelValue"])])):t.patient_type==="Recipient with LD"?(a(),i("div",ee,[s(_,{label:"recipient hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":e[4]||(e[4]=n=>t.hn=n),type:"tel",error:t.patient_error,ref_key:"hnInput",ref:m,onAutosave:e[5]||(e[5]=n=>h("recipient"))},null,8,["modelValue","error"]),s(_,{label:"recipient name",name:"patient_name",modelValue:t.patient_name,"onUpdate:modelValue":e[6]||(e[6]=n=>t.patient_name=n),readonly:""},null,8,["modelValue"]),s(_,{label:"donor hn",name:"donor_hn",modelValue:t.donor_hn,"onUpdate:modelValue":e[7]||(e[7]=n=>t.donor_hn=n),type:"tel",error:t.donor_error,onAutosave:e[8]||(e[8]=n=>h("donor"))},null,8,["modelValue","error"]),s(_,{label:"donor name",name:"donor_name",modelValue:t.donor_name,"onUpdate:modelValue":e[9]||(e[9]=n=>t.donor_name=n),readonly:""},null,8,["modelValue"])])):q("",!0),s(G,{label:"collection date",name:"date_serum",modelValue:t.date_serum,"onUpdate:modelValue":e[10]||(e[10]=n=>t.date_serum=n)},null,8,["modelValue"]),o("div",null,[e[16]||(e[16]=o("label",{class:"form-label"},"Cause of investigation",-1)),o("div",te,[s(A,{label:"HLA typing",name:"request_hla",modelValue:t.request_hla,"onUpdate:modelValue":e[11]||(e[11]=n=>t.request_hla=n)},null,8,["modelValue"]),s(A,{label:"Addition Tissue Typing",name:"request_addition_tissue",modelValue:t.request_addition_tissue,"onUpdate:modelValue":e[12]||(e[12]=n=>t.request_addition_tissue=n)},null,8,["modelValue"]),s(A,{label:"Crossmatch",name:"request_cxm",modelValue:t.request_cxm,"onUpdate:modelValue":e[13]||(e[13]=n=>t.request_cxm=n)},null,8,["modelValue"])])])])):q("",!0)]),_:1})])]),footer:f(()=>[o("div",ne,[o("button",{class:"btn btn-accent",onClick:r,disabled:$.value},e[18]||(e[18]=[o("label",{class:"px-4"},"Confirm",-1)]),8,oe)])]),_:1},512)]))}},le={class:"flex flex-col-reverse md:flex-row justify-between items-center mb-4"},ae={class:"bg-white rounded shadow overflow-x-auto hidden md:block"},re={class:"w-full whitespace-nowrap"},ie={class:"text-left font-semibold text-complement"},de=["textContent","colspan"],ue={key:0,class:"px-6 py-4 border-t"},me=["textContent"],pe={class:"border-t"},ce={class:"flex justify-between items-center"},_e={class:"md:hidden"},fe={class:"flex justify-between items-center my-2 px-2"},ye={class:"bg-primary-darker p-2 rounded-full"},be={class:"my-2 p-2 bg-gray-100 rounded space-y-2"},he={class:"flex items-center justify-between"},xe={class:"font-semibold text-complement text-xs flex items-center"},ve={class:"block py-2 px-1 italic truncate"},ke={class:"flex items-center justify-between text-xs"},Ve=["textContent"],qe=["textContent"],Le={__name:"ReportIndex",props:{reports:{type:Object,required:!0},configs:{type:Object,required:!0},filters:{type:Object,required:!0},routes:{type:Object,required:!0},can:{type:Object,required:!0}},setup(u){const y=u,b=S({search:y.filters.search,scope:y.filters.scope}),v=V(null),g=V(null),t=r=>{F({patient_type:r.patient_type,hn:r.hn,date_serum:r.date_serum,request_hla:r.request_hla??!1,request_cxm:r.request_cxm??!1,request_addition_tissue:r.request_addition_tissue??!1,donor_hn:r.donor_hn??null}).post(y.routes.reportsStore)};let d=null;const m=r=>{switch(d={...r},d.name){case"destroy-report":case"cancel-report":C(d.config);break}},h=r=>{switch(d.name){case"destroy-report":case"cancel-report":F({reason:r}).delete(d.route,{onFinish:()=>d=null});break}},{confirmForm:w,openConfirmForm:C,confirmed:$}=P();return H(()=>v.value.focus()),(r,l)=>(a(),i(c,null,[o("div",le,[s(J,{scopes:u.configs.scopes,form:b,onSearchChanged:l[0]||(l[0]=e=>b.search=e),onScopeChanged:l[1]||(l[1]=e=>b.scope=e),ref_key:"searchInput",ref:v},null,8,["scopes","form"]),u.can.create?(a(),i("button",{key:0,class:"btn btn-accent w-full mb-4 md:w-auto md:px-4 md:mb-0",onClick:l[2]||(l[2]=e=>r.$refs.createForm.open())}," New Report ")):q("",!0)]),o("div",ae,[o("table",re,[o("thead",null,[o("tr",ie,[(a(),i(c,null,k(["HN","Patient","Request","On","Status","Author"],e=>o("th",{class:"px-6 pt-6 pb-4",key:e,textContent:p(e),colspan:e==="Author"?2:1},null,8,de)),64))])]),(a(!0),i(c,null,k(u.reports.data,(e,n)=>(a(),i("tr",{class:"focus-within:bg-primary-darker",key:n},[(a(),i(c,null,k(["hn","patient_name","request","date_serum","status","author"],x=>(a(),i(c,{key:x},[x==="status"?(a(),i("td",ue,[s(R,{status:e.status},null,8,["status"])])):(a(),i("td",{key:1,class:"px-6 py-4 border-t",textContent:p(e[x])},null,8,me))],64))),64)),o("td",pe,[o("div",ce,[s(I,{actions:e.actions,onActionClicked:m},null,8,["actions"])])])]))),128))])]),o("div",_e,[(a(!0),i(c,null,k(u.reports.data,(e,n)=>(a(),i("div",{class:"bg-white rounded shadow my-4 p-4",key:n},[o("div",fe,[o("div",null," HN: "+p(e.hn)+" "+p(e.patient_name),1),e.actions.length>1?(a(),j(B,{key:0},{default:f(()=>[o("div",ye,[s(Q,{class:"w-4 h-4 text-accent"})])]),dropdown:f(()=>[s(W,{actions:e.actions,onActionClicked:m},null,8,["actions"])]),_:2},1024)):e.actions.length===1?(a(),j(I,{key:1,actions:e.actions,onActionClicked:m},null,8,["actions"])):q("",!0)]),o("div",be,[o("div",he,[s(R,{status:e.status},null,8,["status"]),o("p",xe,[o("span",ve,p(e.author),1)])]),o("div",ke,[o("p",null,[l[4]||(l[4]=U(" Serum : ")),o("span",{class:"text-complement font-semibold",textContent:p(e.date_serum)},null,8,Ve)]),o("p",null,[l[5]||(l[5]=U(" Request: ")),o("span",{class:"text-complement font-semibold px-1",textContent:p(e.request)},null,8,qe)])])])]))),128))]),s(z,{links:u.reports.links},null,8,["links"]),s(se,{"service-endpoint":u.routes.patientsShow,onConfirmed:t,ref_key:"createForm",ref:g},null,8,["service-endpoint"]),s(E,{ref_key:"confirmForm",ref:w,onConfirmed:l[3]||(l[3]=e=>L($)(e,h))},null,512)],64))}};export{Le as default};
