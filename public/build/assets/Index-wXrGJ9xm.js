import{r as y,k as D,i as K,h as l,j as M,d as a,e as v,b as s,w as H,f as F,c as r,F as j,l as O,t as g,p as T,m as J,g as S,B,n as P,v as E,u as R,T as W,N as z,A as G}from"./app-DsPwriMT.js";import{_ as U}from"./FormInput-D9w0L8ZP.js";import{M as I}from"./ModalDialog-C-D3KnkS.js";import{_ as L}from"./SpinnerButton-2tJsTxoc.js";import{_ as Q}from"./FormDatetime-iLgjRqWH.js";import{_ as X}from"./FormRadio-sHFbN8bT.js";import{_ as Y}from"./FormAutocomplete-D6aQyRj0.js";import{_ as Z}from"./NoteStatusBadge-o3rWIw2e.js";import{_ as ee}from"./ActionColumn-3eJ2nGaJ.js";import{_ as te}from"./PaginationNav-uZQxv_dV.js";import{_ as A}from"./SearchIndex-BrHp1PhI.js";import{_ as q}from"./FormSelect-DPeg6QVZ.js";import"./throttle-UZPG0zmc.js";import"./pickBy-CQZ6Y9Jq.js";const ne={class:"py-4 my-2 md:py-6 md:my-4 border-t border-b border-accent-darker"},oe={class:"bg-gray-100 text-gray-100 whitespace-nowrap"},se={key:1,class:"bg-white rounded shadow p-2 lg:p-4 text-sm"},le={class:"text-complement uppercase font-semibold"},ae={key:0},re={class:"grid grid-cols-2 gap-4"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={key:0,class:"space-y-2"},ue={key:1,class:"space-y-2"},me={class:"flex justify-end items-center"},ce=["disabled"],pe={__name:"CreateForm",props:{serviceEndpoints:{type:Object,required:!0}},emits:["confirmed"],setup(u,{expose:k,emit:$}){const p=u,x=$,i=y(null),c=y(null),_=y(!1),e=D({hn:null,date_transplant:null,case_no:null,donor_type:null,donor_hn:null,donor_name:null,donor_hospital:null,donor_redcross_id:null}),n=D({hn:null,name:null,gender:null,age:null}),o=D({hn:null});function w(b=!1){_.value=!0,o.hn=null,b||Object.keys(n).map(t=>n[t]=null),window.axios.post(p.serviceEndpoints.patients_show,{hn:b?e.donor_hn:e.hn}).then(t=>{if(!t.data.found){o.hn=t.data.message;return}if(b){e.donor_name=t.data.name;return}Object.keys(n).map(C=>n[C]=t.data[C]??null),n.hn=e.hn}).catch(t=>{console.log(t)}).finally(()=>{_.value=!1})}function f(){i.value.open(),Object.keys(n).map(b=>n[b]=null),P(()=>c.value.focus())}function h(){e.hn=n.hn,x("confirmed",{...e}),i.value.close()}const V=K(()=>{var b;return!e.hn||!e.date_transplant||!e.case_no||!e.donor_type?!1:(b=e.donor_type)!=null&&b.startsWith("LD")?e.donor_hn&&e.donor_name:e.donor_redcross_id&&e.donor_hospital});return k({open:f}),(b,t)=>(l(),M(B,{to:"body"},[a(I,{ref_key:"modal",ref:i,"width-mode":"form-cols-1",onClosed:t[11]||(t[11]=C=>Object.keys(e).map(d=>e[d]=null))},{header:v(()=>t[12]||(t[12]=[s("div",{class:"font-semibold text-complement"}," Search HN ",-1)])),body:v(()=>{var C;return[s("div",ne,[a(U,{label:"recipient hn",name:"hn",modelValue:e.hn,"onUpdate:modelValue":t[0]||(t[0]=d=>e.hn=d),type:"tel",error:o.hn,ref_key:"anInput",ref:c,onKeydown:t[1]||(t[1]=H(d=>w(),["enter"]))},null,8,["modelValue","error"]),a(L,{spin:_.value,class:"btn-complement w-full mt-2",onClick:t[2]||(t[2]=d=>w()),disabled:!((C=e.hn)!=null&&C.length)},{default:v(()=>t[13]||(t[13]=[F(" SEARCH ")])),_:1},8,["spin","disabled"]),t[16]||(t[16]=s("hr",{class:"my-4 md:my-6"},null,-1)),t[17]||(t[17]=s("span",{class:"form-label block"},"recipient data",-1)),n.hn?(l(),r("div",se,[(l(!0),r(j,null,O([...Object.keys(n)].filter(d=>n[d]),d=>(l(),r("p",{class:"mt-1 whitespace-nowrap",key:d},[s("span",le,g(d.replaceAll("_"," "))+" : ",1),F(" "+g(n[d]),1)]))),128))])):(l(),r("div",{key:0,class:T(["bg-white rounded shadow p-2 lg:p-4 text-sm",{"animate-pulse":_.value}])},[(l(!0),r(j,null,O(Object.keys(n),d=>(l(),r("div",{class:"mt-1",key:d},[s("span",oe,g(d)+" placeholder ",1)]))),128))],2)),a(J,{name:"slide-fade"},{default:v(()=>{var d,N;return[n.hn?(l(),r("div",ae,[t[14]||(t[14]=s("hr",{class:"my-4 md:my-6"},null,-1)),s("div",re,[a(Q,{label:"date transplant",name:"date_transplant",modelValue:e.date_transplant,"onUpdate:modelValue":t[3]||(t[3]=m=>e.date_transplant=m)},null,8,["modelValue"]),a(U,{label:"case no",name:"case_no",modelValue:e.case_no,"onUpdate:modelValue":t[4]||(t[4]=m=>e.case_no=m),type:"tel"},null,8,["modelValue"])]),t[15]||(t[15]=s("hr",{class:"my-4 md:my-6"},null,-1)),s("div",de,[a(X,{label:"kidney donor type",name:"donor_type",modelValue:e.donor_type,"onUpdate:modelValue":t[5]||(t[5]=m=>e.donor_type=m),options:["CD single kidney","CD dual kidneys","LD"]},null,8,["modelValue"]),(d=e.donor_type)!=null&&d.startsWith("LD")?(l(),r("div",ie,[a(U,{label:"Donor HN",name:"donor_hn",modelValue:e.donor_hn,"onUpdate:modelValue":t[6]||(t[6]=m=>e.donor_hn=m),type:"tel",onAutosave:t[7]||(t[7]=m=>w(!0))},null,8,["modelValue"]),a(U,{name:"donor_name",modelValue:e.donor_name,"onUpdate:modelValue":t[8]||(t[8]=m=>e.donor_name=m),readonly:""},null,8,["modelValue"])])):(N=e.donor_type)!=null&&N.startsWith("CD")?(l(),r("div",ue,[a(U,{label:"donor redcross id",name:"donor_redcross_id",modelValue:e.donor_redcross_id,"onUpdate:modelValue":t[9]||(t[9]=m=>e.donor_redcross_id=m)},null,8,["modelValue"]),a(Y,{placeholder:"donor hospital",name:"donor_hospital",modelValue:e.donor_hospital,"onUpdate:modelValue":t[10]||(t[10]=m=>e.donor_hospital=m),endpoint:u.serviceEndpoints.hospitals},null,8,["modelValue","endpoint"])])):S("",!0)])])):S("",!0)]}),_:1})])]}),footer:v(()=>[s("div",me,[s("button",{class:"btn btn-accent",onClick:h,disabled:!V.value}," Confirm ",8,ce)])]),_:1},512)]))}},fe={class:"py-4 my-2 md:py-6 md:my-4 border-t border-b border-accent-darker"},_e={class:"flex justify-between"},ye={key:0,class:"mt-2 pl-1 font-semibold italic text-accent"},he={key:1,class:"mt-2 pl-1 font-semibold italic text-accent"},be={class:"flex justify-end items-center"},ve={__name:"UpdateByMonth",props:{url:{type:String,required:!0}},emits:["done"],setup(u,{expose:k,emit:$}){const p=u,x=y(null),i=y(0),c=y(0),_=y(null),e=y([]),n=$;E(()=>_.value,f=>{if(!f){e.value=[],i.value=0,c.value=0;return}const h=p.url.replace("month",f);window.axios.get(h).then(V=>{e.value=[...V.data]}).catch(V=>{console.log(V)})},{immediate:!0});function o(){e.value.length===c.value&&(x.value.close(),n("done")),e.value.forEach(f=>{i.value++,window.axios.post(f.url).then(h=>{console.log(h.data)}).finally(()=>{c.value++})})}function w(){x.value.open(),_.value=null}return k({open:w}),(f,h)=>(l(),M(B,{to:"body"},[a(I,{ref_key:"modal",ref:x,"width-mode":"form-cols-1"},{header:v(()=>h[1]||(h[1]=[s("div",{class:"font-semibold text-complement"}," Update all cases by month ",-1)])),body:v(()=>[s("div",fe,[a(q,{disabled:c.value&&c.value!==i.value,modelValue:_.value,"onUpdate:modelValue":h[0]||(h[0]=V=>_.value=V),name:"month",options:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},null,8,["disabled","modelValue"]),s("div",_e,[e.value.length?(l(),r("p",ye,g(e.value.length)+" active cases ",1)):S("",!0),i.value?(l(),r("p",he,g(c.value)+" cases done. ",1)):S("",!0)])])]),footer:v(()=>[s("div",be,[a(L,{class:"btn btn-accent w-32",spin:i.value>0&&i.value!==c.value,disabled:e.value.length===0,onClick:o},{default:v(()=>[F(g(i.value>0&&i.value===c.value?"OK":"UPDATE"),1)]),_:1},8,["spin","disabled"])])]),_:1},512)]))}},ge={class:"flex flex-col-reverse md:flex-row justify-between items-center mb-4"},ke={class:"hidden lg:flex lg:gap-x-2"},xe={class:"bg-white rounded shadow overflow-x-auto"},we={class:"w-full whitespace-nowrap"},Ve={class:"text-left font-semibold text-complement"},$e=["textContent","colspan"],Ce={key:0,class:"px-6 py-4 border-t"},je=["textContent"],Ue=["textContent"],Oe={class:"border-t"},Se={class:"flex justify-between items-center"},Pe={__name:"Index",props:{caseRecords:{type:Object,required:!0},configs:{type:Object,required:!0}},setup(u){const k=u,$=y(null),p=D({search:k.configs.filters.search,scope:k.configs.filters.scope,mo:k.configs.filters.mo}),x=y(null),i=y(null);function c(e){W({...e}).post(k.configs.routes.store)}const{actionStore:_}=G();return E(()=>_.value,e=>{switch(e.name){case"update-by-month":i.value.open();break;default:return}},{deep:!0}),(e,n)=>(l(),r("div",null,[s("div",ge,[a(A,{class:"lg:hidden",scopes:u.configs.scopes,form:p,onSearchChanged:n[0]||(n[0]=o=>p.search=o),onScopeChanged:n[1]||(n[1]=o=>p.scope=o),ref_key:"searchInput",ref:$},null,8,["scopes","form"]),s("div",ke,[a(A,{scopes:u.configs.scopes,form:p,onSearchChanged:n[2]||(n[2]=o=>p.search=o),onScopeChanged:n[3]||(n[3]=o=>p.scope=o),ref_key:"searchInput",ref:$},null,8,["scopes","form"]),a(q,{class:"hidden lg:block lg:w-auto",modelValue:p.mo,"onUpdate:modelValue":n[4]||(n[4]=o=>p.mo=o),name:"md",options:u.configs.month_options,placeholder:"Filter by Month"},null,8,["modelValue","options"])]),u.configs.can.create?(l(),r("button",{key:0,class:"btn btn-accent w-full mb-4 md:w-auto md:px-4 md:mb-0",onClick:n[5]||(n[5]=o=>x.value.open())}," New Case ")):S("",!0)]),s("div",xe,[s("table",we,[s("thead",null,[s("tr",Ve,[(l(),r(j,null,O(["KT-NO","Date Tx","Patient","Status","Annual Cr","Last Update"],o=>s("th",{class:"px-6 pt-6 pb-4",key:o,textContent:g(o),colspan:o==="Last Update"?2:1},null,8,$e)),64))])]),s("tbody",null,[(l(!0),r(j,null,O(u.caseRecords.data,(o,w)=>(l(),r("tr",{class:"focus-within:bg-primary-darker",key:w},[(l(),r(j,null,O(["kt_no","date_transplant","patient","status","annual_cr","last_update"],f=>(l(),r(j,{key:f},[f==="status"?(l(),r("td",Ce,[a(Z,{status:o.status},null,8,["status"])])):f==="annual_cr"?(l(),r("td",{key:1,class:T(["px-6 py-4 border-t font-medium",(o.annual_cr&&parseFloat(o.annual_cr))<=4?"text-green-500":"text-red-500"]),textContent:g(o.annual_cr)},null,10,je)):(l(),r("td",{key:2,class:"px-6 py-4 border-t",textContent:g(o[f])},null,8,Ue))],64))),64)),s("td",Oe,[s("div",Se,[a(ee,{actions:o.actions},null,8,["actions"])])])]))),128))])])]),a(te,{links:u.caseRecords.links},null,8,["links"]),a(pe,{"service-endpoints":u.configs.routes,ref_key:"createFormRef",ref:x,onConfirmed:c},null,8,["service-endpoints"]),a(ve,{ref_key:"updateFormRef",ref:i,url:u.configs.routes.month_cases,onDone:n[6]||(n[6]=o=>R(z).reload())},null,8,["url"])]))}};export{Pe as default};
