import{l as R,r as V,j as S,b as l,k as j,e as s,f,d as o,q as T,c as r,h as q,D as N,n as O,o as H,F as p,m as k,u as L,T as F,t as c,E as B,g as U}from"./app-a632d1c7.js";import{u as E}from"./useConfirmForm-a92ab0f0.js";import{_ as I,I as P,a as M}from"./IconDoubleDown-3cbd91e6.js";import K from"./ConfirmFormComposable-cc8634a2.js";import{M as z}from"./ModalDialog-aff04e60.js";import{_}from"./FormInput-1b9d48bc.js";import{_ as G}from"./FormDatetime-7ce50b2a.js";import{_ as J}from"./FormRadio-ff22e3d8.js";import{_ as A}from"./FormCheckbox-5ef766d1.js";import{_ as Q}from"./PaginationNav-877255c2.js";import{_ as W}from"./SearchIndex-e3a41176.js";import{_ as D}from"./NoteStatusBadge-0780cf5f.js";import"./SpinnerButton-6b62f518.js";import"./pickBy-98efb167.js";import"./throttle-aa64b215.js";const X=o("div",{class:"font-semibold text-complement"}," HLA typing for KT Report ",-1),Y={class:"py-4 my-2 md:py-6 md:my-4 border-t border-b border-accent-darker"},Z=o("label",{class:"form-label"},"patient type :",-1),ee={key:0,class:"space-y-2"},te={key:0,class:"space-y-2"},ne={key:1,class:"space-y-2 md:space-y-0 md:grid grid-cols-2 gap-4"},oe=o("label",{class:"form-label"},"Cause of investigation",-1),se={class:"sm:grid-cols-2 gap-x-2"},le={class:"flex justify-end items-center"},ae=["disabled"],re=o("label",{class:"px-4"},"Confirm",-1),ie=[re],de={__name:"CreateForm",props:{serviceEndpoint:{type:String,required:!0}},emits:["confirmed"],setup(u,{expose:y,emit:h}){const v=u,g=h,t=R({patient_type:null,hn:null,patient_name:null,patient_error:null,date_serum:null,donor_hn:null,donor_name:null,donor_error:null,request_hla:!1,request_cxm:!1,request_addition_tissue:!1}),d=V(null),m=V(null),b=i=>{let e;i==="recipient"?(e=t.hn,t.patient_name=null,t.patient_error=null):(e=t.donor_hn,t.donor_name=null,t.donor_error=null),window.axios.post(v.serviceEndpoint,{hn:e}).then(n=>{n.data.found?i==="recipient"?t.patient_name=n.data.name:t.donor_name=n.data.name:i==="recipient"?t.patient_error=n.data.message:t.donor_error=n.data.message}).catch(n=>console.log(n))},w=()=>{d.value.open()},$=()=>{O(()=>m.value.focus())},C=S(()=>t.patient_type?t.patient_type==="Patient"?!t.patient_name||!t.date_serum||!t.request_cxm&&!t.request_hla&&!t.request_addition_tissue:!t.patient_name||!t.date_serum||!t.request_cxm&&!t.request_hla&&!t.request_addition_tissue||!t.donor_name:!0),a=()=>{d.value.close(),g("confirmed",{...t})};return y({open:w}),(i,e)=>(l(),j(N,{to:"body"},[s(z,{ref_key:"modal",ref:d,"width-mode":"form-cols-1",onClosed:e[14]||(e[14]=n=>Object.keys(t).map(x=>t[x]=null))},{header:f(()=>[X]),body:f(()=>[o("div",Y,[Z,s(J,{name:"patient_type",class:"md:grid grid-cols-2 gap-4",modelValue:t.patient_type,"onUpdate:modelValue":e[0]||(e[0]=n=>t.patient_type=n),options:["Patient","Recipient with LD"],onAutosave:$},null,8,["modelValue"]),s(T,{name:"slide-fade"},{default:f(()=>[t.patient_type?(l(),r("div",ee,[t.patient_type==="Patient"?(l(),r("div",te,[s(_,{label:"patient hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":e[1]||(e[1]=n=>t.hn=n),type:"tel",error:t.patient_error,ref_key:"hnInput",ref:m,onAutosave:e[2]||(e[2]=n=>b("recipient"))},null,8,["modelValue","error"]),s(_,{label:"patient name",name:"patient_name",modelValue:t.patient_name,"onUpdate:modelValue":e[3]||(e[3]=n=>t.patient_name=n),readonly:""},null,8,["modelValue"])])):t.patient_type==="Recipient with LD"?(l(),r("div",ne,[s(_,{label:"recipient hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":e[4]||(e[4]=n=>t.hn=n),type:"tel",error:t.patient_error,ref_key:"hnInput",ref:m,onAutosave:e[5]||(e[5]=n=>b("recipient"))},null,8,["modelValue","error"]),s(_,{label:"recipient name",name:"patient_name",modelValue:t.patient_name,"onUpdate:modelValue":e[6]||(e[6]=n=>t.patient_name=n),readonly:""},null,8,["modelValue"]),s(_,{label:"donor hn",name:"donor_hn",modelValue:t.donor_hn,"onUpdate:modelValue":e[7]||(e[7]=n=>t.donor_hn=n),type:"tel",error:t.donor_error,onAutosave:e[8]||(e[8]=n=>b("donor"))},null,8,["modelValue","error"]),s(_,{label:"donor name",name:"donor_name",modelValue:t.donor_name,"onUpdate:modelValue":e[9]||(e[9]=n=>t.donor_name=n),readonly:""},null,8,["modelValue"])])):q("",!0),s(G,{label:"collection date",name:"date_serum",modelValue:t.date_serum,"onUpdate:modelValue":e[10]||(e[10]=n=>t.date_serum=n)},null,8,["modelValue"]),o("div",null,[oe,o("div",se,[s(A,{label:"HLA typing",name:"request_hla",modelValue:t.request_hla,"onUpdate:modelValue":e[11]||(e[11]=n=>t.request_hla=n)},null,8,["modelValue"]),s(A,{label:"Addition Tissue Typing",name:"request_addition_tissue",modelValue:t.request_addition_tissue,"onUpdate:modelValue":e[12]||(e[12]=n=>t.request_addition_tissue=n)},null,8,["modelValue"]),s(A,{label:"Crossmatch",name:"request_cxm",modelValue:t.request_cxm,"onUpdate:modelValue":e[13]||(e[13]=n=>t.request_cxm=n)},null,8,["modelValue"])])])])):q("",!0)]),_:1})])]),footer:f(()=>[o("div",le,[o("button",{class:"btn btn-accent",onClick:a,disabled:C.value},ie,8,ae)])]),_:1},512)]))}},ue={class:"flex flex-col-reverse md:flex-row justify-between items-center mb-4"},me={class:"bg-white rounded shadow overflow-x-auto hidden md:block"},ce={class:"w-full whitespace-nowrap"},pe={class:"text-left font-semibold text-complement"},_e=["textContent","colspan"],fe={key:0,class:"px-6 py-4 border-t"},ye=["textContent"],he={class:"border-t"},be={class:"flex justify-between items-center"},xe={class:"md:hidden"},ve={class:"flex justify-between items-center my-2 px-2"},ke={class:"bg-primary-darker p-2 rounded-full"},Ve={class:"my-2 p-2 bg-gray-100 rounded space-y-2"},qe={class:"flex items-center justify-between"},ge={class:"font-semibold text-complement text-xs flex items-center"},we={class:"block py-2 px-1 italic truncate"},$e={class:"flex items-center justify-between text-xs"},Ce=["textContent"],Ae=["textContent"],Me={__name:"ReportIndex",props:{reports:{type:Object,required:!0},configs:{type:Object,required:!0},filters:{type:Object,required:!0},routes:{type:Object,required:!0},can:{type:Object,required:!0}},setup(u){const y=u,h=R({search:y.filters.search,scope:y.filters.scope}),v=V(null),g=V(null),t=a=>{F({patient_type:a.patient_type,hn:a.hn,date_serum:a.date_serum,request_hla:a.request_hla??!1,request_cxm:a.request_cxm??!1,request_addition_tissue:a.request_addition_tissue??!1,donor_hn:a.donor_hn??null}).post(y.routes.reportsStore)};let d=null;const m=a=>{switch(d={...a},d.name){case"destroy-report":case"cancel-report":$(d.config);break}},b=a=>{switch(d.name){case"destroy-report":case"cancel-report":F({reason:a}).delete(d.route,{onFinish:()=>d=null});break}},{confirmForm:w,openConfirmForm:$,confirmed:C}=E();return H(()=>v.value.focus()),(a,i)=>(l(),r(p,null,[o("div",ue,[s(W,{scopes:u.configs.scopes,form:h,onSearchChanged:i[0]||(i[0]=e=>h.search=e),onScopeChanged:i[1]||(i[1]=e=>h.scope=e),ref_key:"searchInput",ref:v},null,8,["scopes","form"]),u.can.create?(l(),r("button",{key:0,class:"btn btn-accent w-full mb-4 md:w-auto md:px-4 md:mb-0",onClick:i[2]||(i[2]=e=>a.$refs.createForm.open())}," New Report ")):q("",!0)]),o("div",me,[o("table",ce,[o("tr",pe,[(l(),r(p,null,k(["HN","Patient","Request","On","Status","Author"],e=>o("th",{class:"px-6 pt-6 pb-4",key:e,textContent:c(e),colspan:e==="Author"?2:1},null,8,_e)),64))]),(l(!0),r(p,null,k(u.reports.data,(e,n)=>(l(),r("tr",{class:"focus-within:bg-primary-darker",key:n},[(l(),r(p,null,k(["hn","patient_name","request","date_serum","status","author"],x=>(l(),r(p,{key:x},[x==="status"?(l(),r("td",fe,[s(D,{status:e.status},null,8,["status"])])):(l(),r("td",{key:1,class:"px-6 py-4 border-t",textContent:c(e[x])},null,8,ye))],64))),64)),o("td",he,[o("div",be,[s(I,{actions:e.actions,onActionClicked:m},null,8,["actions"])])])]))),128))])]),o("div",xe,[(l(!0),r(p,null,k(u.reports.data,(e,n)=>(l(),r("div",{class:"bg-white rounded shadow my-4 p-4",key:n},[o("div",ve,[o("div",null," HN: "+c(e.hn)+" "+c(e.patient_name),1),e.actions.length>1?(l(),j(B,{key:0},{default:f(()=>[o("div",ke,[s(P,{class:"w-4 h-4 text-accent"})])]),dropdown:f(()=>[s(M,{actions:e.actions,onActionClicked:m},null,8,["actions"])]),_:2},1024)):e.actions.length===1?(l(),j(I,{key:1,actions:e.actions,onActionClicked:m},null,8,["actions"])):q("",!0)]),o("div",Ve,[o("div",qe,[s(D,{status:e.status},null,8,["status"]),o("p",ge,[o("span",we,c(e.author),1)])]),o("div",$e,[o("p",null,[U(" Serum : "),o("span",{class:"text-complement font-semibold",textContent:c(e.date_serum)},null,8,Ce)]),o("p",null,[U(" Request: "),o("span",{class:"text-complement font-semibold px-1",textContent:c(e.request)},null,8,Ae)])])])]))),128))]),s(Q,{links:u.reports.links},null,8,["links"]),s(de,{"service-endpoint":u.routes.patientsShow,onConfirmed:t,ref_key:"createForm",ref:g},null,8,["service-endpoint"]),s(K,{ref_key:"confirmForm",ref:w,onConfirmed:i[3]||(i[3]=e=>L(C)(e,b))},null,512)],64))}};export{Me as default};
