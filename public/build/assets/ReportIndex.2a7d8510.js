import{x as S,r as V,s as D,o as l,v as j,a as s,w as y,b as o,T as H,c as r,f as q,u as T,aa as N,j as O,i as L,F as _,d as k,P as F,t as c,H as P,e as U}from"./app.c49ecac0.js";import{u as B}from"./useConfirmForm.9374150e.js";import{_ as I,I as E,a as M}from"./IconDoubleDown.07f24e8d.js";import K from"./ConfirmFormComposable.c4c006a1.js";import{M as z}from"./ModalDialog.c2f86c92.js";import{_ as f}from"./FormInput.aa0921f7.js";import{_ as G}from"./FormDatetime.e4a86415.js";import{_ as J}from"./FormRadio.7679d42d.js";import{_ as A}from"./FormCheckbox.1a038347.js";import{_ as Q}from"./PaginationNav.66eba5ba.js";import{_ as W}from"./SearchIndex.99606342.js";import{_ as R}from"./NoteStatusBadge.22edf7ef.js";import"./SpinnerButton.fe2730dd.js";import"./pickBy.3911dd14.js";import"./throttle.6f7722ce.js";const X=o("div",{class:"font-semibold text-complement"}," HLA typing for KT Report ",-1),Y={class:"py-4 my-2 md:py-6 md:my-4 border-t border-b border-accent-darker"},Z=o("label",{class:"form-label"},"patient type :",-1),ee={key:0,class:"space-y-2"},te={key:0,class:"space-y-2"},ne={key:1,class:"space-y-2 md:space-y-0 md:grid grid-cols-2 gap-4"},oe=o("label",{class:"form-label"},"Cause of investigation",-1),se={class:"sm:grid-cols-2 gap-x-2"},ae={class:"flex justify-end items-center"},le=["disabled"],re=o("label",{class:"px-4"},"Confirm",-1),ie=[re],de={__name:"CreateForm",props:{serviceEndpoint:{type:String,required:!0}},emits:["confirmed"],setup(d,{expose:h,emit:b}){const v=d,t=S({patient_type:null,hn:null,patient_name:null,patient_error:null,date_serum:null,donor_hn:null,donor_name:null,donor_error:null,request_hla:!1,request_cxm:!1,request_addition_tissue:!1}),x=V(null),i=V(null),m=a=>{let n;a==="recipient"?(n=t.hn,t.patient_name=null,t.patient_error=null):(n=t.donor_hn,t.donor_name=null,t.donor_error=null),window.axios.post(v.serviceEndpoint,{hn:n}).then(e=>{e.data.found?a==="recipient"?t.patient_name=e.data.name:t.donor_name=e.data.name:a==="recipient"?t.patient_error=e.data.message:t.donor_error=e.data.message}).catch(e=>console.log(e))},g=()=>{x.value.open()},w=()=>{O(()=>i.value.focus())},$=D(()=>t.patient_type?t.patient_type==="Patient"?!t.patient_name||!t.date_serum||!t.request_cxm&&!t.request_hla&&!t.request_addition_tissue:!t.patient_name||!t.date_serum||!t.request_cxm&&!t.request_hla&&!t.request_addition_tissue||!t.donor_name:!0),C=()=>{x.value.close(),b("confirmed",{...t})};return h({open:g}),(a,n)=>(l(),j(N,{to:"body"},[s(z,{ref_key:"modal",ref:x,"width-mode":"form-cols-1",onClosed:n[14]||(n[14]=e=>Object.keys(t).map(u=>t[u]=null))},{header:y(()=>[X]),body:y(()=>[o("div",Y,[Z,s(J,{name:"patient_type",class:"md:grid grid-cols-2 gap-4",modelValue:t.patient_type,"onUpdate:modelValue":n[0]||(n[0]=e=>t.patient_type=e),options:["Patient","Recipient with LD"],onAutosave:w},null,8,["modelValue"]),s(H,{name:"slide-fade"},{default:y(()=>[t.patient_type?(l(),r("div",ee,[t.patient_type==="Patient"?(l(),r("div",te,[s(f,{label:"patient hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":n[1]||(n[1]=e=>t.hn=e),type:"tel",error:t.patient_error,ref_key:"hnInput",ref:i,onAutosave:n[2]||(n[2]=e=>m("recipient"))},null,8,["modelValue","error"]),s(f,{label:"patient name",name:"patient_name",modelValue:t.patient_name,"onUpdate:modelValue":n[3]||(n[3]=e=>t.patient_name=e),readonly:""},null,8,["modelValue"])])):t.patient_type==="Recipient with LD"?(l(),r("div",ne,[s(f,{label:"recipient hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":n[4]||(n[4]=e=>t.hn=e),type:"tel",error:t.patient_error,ref_key:"hnInput",ref:i,onAutosave:n[5]||(n[5]=e=>m("recipient"))},null,8,["modelValue","error"]),s(f,{label:"recipient name",name:"patient_name",modelValue:t.patient_name,"onUpdate:modelValue":n[6]||(n[6]=e=>t.patient_name=e),readonly:""},null,8,["modelValue"]),s(f,{label:"donor hn",name:"donor_hn",modelValue:t.donor_hn,"onUpdate:modelValue":n[7]||(n[7]=e=>t.donor_hn=e),type:"tel",error:t.donor_error,onAutosave:n[8]||(n[8]=e=>m("donor"))},null,8,["modelValue","error"]),s(f,{label:"donor name",name:"donor_name",modelValue:t.donor_name,"onUpdate:modelValue":n[9]||(n[9]=e=>t.donor_name=e),readonly:""},null,8,["modelValue"])])):q("",!0),s(G,{label:"collection date",name:"date_serum",modelValue:t.date_serum,"onUpdate:modelValue":n[10]||(n[10]=e=>t.date_serum=e)},null,8,["modelValue"]),o("div",null,[oe,o("div",se,[s(A,{label:"HLA typing",name:"request_hla",modelValue:t.request_hla,"onUpdate:modelValue":n[11]||(n[11]=e=>t.request_hla=e)},null,8,["modelValue"]),s(A,{label:"Addition Tissue Typing",name:"request_addition_tissue",modelValue:t.request_addition_tissue,"onUpdate:modelValue":n[12]||(n[12]=e=>t.request_addition_tissue=e)},null,8,["modelValue"]),s(A,{label:"Crossmatch",name:"request_cxm",modelValue:t.request_cxm,"onUpdate:modelValue":n[13]||(n[13]=e=>t.request_cxm=e)},null,8,["modelValue"])])])])):q("",!0)]),_:1})])]),footer:y(()=>[o("div",ae,[o("button",{class:"btn btn-accent",onClick:C,disabled:T($)},ie,8,le)])]),_:1},512)]))}},ue={class:"flex flex-col-reverse md:flex-row justify-between items-center mb-4"},me={class:"bg-white rounded shadow overflow-x-auto hidden md:block"},ce={class:"w-full whitespace-nowrap"},pe={class:"text-left font-semibold text-complement"},_e=["textContent","colspan"],fe={key:0,class:"px-6 py-4 border-t"},ye=["textContent"],he={class:"border-t"},be={class:"flex justify-between items-center"},xe={class:"md:hidden"},ve={class:"flex justify-between items-center my-2 px-2"},ke={class:"bg-primary-darker p-2 rounded-full"},Ve={class:"my-2 p-2 bg-gray-100 rounded space-y-2"},qe={class:"flex items-center justify-between"},ge={class:"font-semibold text-complement text-xs flex items-center"},we={class:"block py-2 px-1 italic truncate"},$e={class:"flex items-center justify-between text-xs"},Ce=["textContent"],Ae=["textContent"],Me={__name:"ReportIndex",props:{reports:{type:Object,required:!0},configs:{type:Object,required:!0},filters:{type:Object,required:!0},routes:{type:Object,required:!0},can:{type:Object,required:!0}},setup(d){const h=d,b=S({search:h.filters.search,scope:h.filters.scope}),v=V(null),t=V(null),x=a=>{var n,e,u,p;F({patient_type:a.patient_type,hn:a.hn,date_serum:a.date_serum,request_hla:(n=a.request_hla)!=null?n:!1,request_cxm:(e=a.request_cxm)!=null?e:!1,request_addition_tissue:(u=a.request_addition_tissue)!=null?u:!1,donor_hn:(p=a.donor_hn)!=null?p:null}).post(h.routes.reportsStore)};let i=null;const m=a=>{switch(i={...a},i.name){case"destroy-report":case"cancel-report":$(i.config);break}},g=a=>{switch(i.name){case"destroy-report":case"cancel-report":F({reason:a}).delete(i.route,{onFinish:()=>i=null});break}},{confirmForm:w,openConfirmForm:$,confirmed:C}=B();return L(()=>v.value.focus()),(a,n)=>(l(),r(_,null,[o("div",ue,[s(W,{scopes:d.configs.scopes,form:b,onSearchChanged:n[0]||(n[0]=e=>b.search=e),onScopeChanged:n[1]||(n[1]=e=>b.scope=e),ref_key:"searchInput",ref:v},null,8,["scopes","form"]),d.can.create?(l(),r("button",{key:0,class:"btn btn-accent w-full mb-4 md:w-auto md:px-4 md:mb-0",onClick:n[2]||(n[2]=e=>a.$refs.createForm.open())}," New Report ")):q("",!0)]),o("div",me,[o("table",ce,[o("tr",pe,[(l(),r(_,null,k(["HN","Patient","Request","On","Status","Author"],e=>o("th",{class:"px-6 pt-6 pb-4",key:e,textContent:c(e),colspan:e==="Author"?2:1},null,8,_e)),64))]),(l(!0),r(_,null,k(d.reports.data,(e,u)=>(l(),r("tr",{class:"focus-within:bg-primary-darker",key:u},[(l(),r(_,null,k(["hn","patient_name","request","date_serum","status","author"],p=>(l(),r(_,{key:p},[p==="status"?(l(),r("td",fe,[s(R,{status:e.status},null,8,["status"])])):(l(),r("td",{key:1,class:"px-6 py-4 border-t",textContent:c(e[p])},null,8,ye))],64))),64)),o("td",he,[o("div",be,[s(I,{actions:e.actions,onActionClicked:m},null,8,["actions"])])])]))),128))])]),o("div",xe,[(l(!0),r(_,null,k(d.reports.data,(e,u)=>(l(),r("div",{class:"bg-white rounded shadow my-4 p-4",key:u},[o("div",ve,[o("div",null," HN: "+c(e.hn)+" "+c(e.patient_name),1),e.actions.length>1?(l(),j(P,{key:0},{default:y(()=>[o("div",ke,[s(E,{class:"w-4 h-4 text-accent"})])]),dropdown:y(()=>[s(M,{actions:e.actions,onActionClicked:m},null,8,["actions"])]),_:2},1024)):e.actions.length===1?(l(),j(I,{key:1,actions:e.actions,onActionClicked:m},null,8,["actions"])):q("",!0)]),o("div",Ve,[o("div",qe,[s(R,{status:e.status},null,8,["status"]),o("p",ge,[o("span",we,c(e.author),1)])]),o("div",$e,[o("p",null,[U(" Serum : "),o("span",{class:"text-complement font-semibold",textContent:c(e.date_serum)},null,8,Ce)]),o("p",null,[U(" Request: "),o("span",{class:"text-complement font-semibold px-1",textContent:c(e.request)},null,8,Ae)])])])]))),128))]),s(Q,{links:d.reports.links},null,8,["links"]),s(de,{"service-endpoint":d.routes.patientsShow,onConfirmed:x,ref_key:"createForm",ref:t},null,8,["service-endpoint"]),s(K,{ref_key:"confirmForm",ref:w,onConfirmed:n[3]||(n[3]=e=>T(C)(e,g))},null,512)],64))}};export{Me as default};
