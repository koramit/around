import{v as R,r as w,q as T,o as r,s as j,a as o,w as y,b as s,T as D,c as l,f as V,u as x,aa as H,i as O,n as L,t as c,h as B,F as b,d as k,j as U,H as P,e as S}from"./app.2f152dff.js";import{u as E}from"./useConfirmForm.236309da.js";import{_ as I,I as M,a as z}from"./IconDoubleDown.5468f937.js";import K from"./ConfirmFormComposable.9018bb86.js";import{M as G}from"./ModalDialog.ba59768b.js";import{_ as h}from"./FormInput.55b609c4.js";import{_ as J}from"./FormDatetime.88603669.js";import{_ as Q}from"./FormRadio.e4ee82b5.js";import{_ as F}from"./FormCheckbox.4fe70559.js";import{_ as W}from"./PaginationNav.29a67de2.js";import{_ as X}from"./SearchIndex.e86092fe.js";import"./SpinnerButton.020f3bed.js";import"./pickBy.63bdb433.js";import"./throttle.356eed9c.js";const Y=s("div",{class:"font-semibold text-complement"}," HLA typing for KT Report ",-1),Z={class:"py-4 my-2 md:py-6 md:my-4 border-t border-b border-accent-darker"},ee=s("label",{class:"form-label"},"patient type :",-1),te={key:0,class:"space-y-2"},ne={key:0,class:"space-y-2"},se={key:1,class:"space-y-2 md:space-y-0 md:grid grid-cols-2 gap-4"},oe=s("label",{class:"form-label"},"Cause of investigation",-1),ae={class:"sm:grid-cols-2 gap-x-2"},re={class:"flex justify-end items-center"},le=["disabled"],ie=s("label",{class:"px-4"},"Confirm",-1),de=[ie],ue={__name:"CreateForm",props:{serviceEndpoint:{type:String,required:!0}},emits:["confirmed"],setup(i,{expose:p,emit:d}){const g=i,t=R({patient_type:null,hn:null,patient_name:null,patient_error:null,date_serum:null,donor_hn:null,donor_name:null,donor_error:null,request_hla:!1,request_cxm:!1,request_addition_tissue:!1}),v=w(null),u=w(null),_=a=>{let n;a==="recipient"?(n=t.hn,t.patient_name=null,t.patient_error=null):(n=t.donor_hn,t.donor_name=null,t.donor_error=null),window.axios.post(g.serviceEndpoint,{hn:n}).then(e=>{e.data.found?a==="recipient"?t.patient_name=e.data.name:t.donor_name=e.data.name:a==="recipient"?t.patient_error=e.data.message:t.donor_error=e.data.message}).catch(e=>console.log(e))},q=()=>{v.value.open()},C=()=>{O(()=>u.value.focus())},$=T(()=>t.patient_type?t.patient_type==="Patient"?!t.patient_name||!t.date_serum||!t.request_cxm&&!t.request_hla&&!t.request_addition_tissue:!t.patient_name||!t.date_serum||!t.request_cxm&&!t.request_hla&&!t.request_addition_tissue||!t.donor_name:!0),A=()=>{v.value.close(),d("confirmed",{...t})};return p({open:q}),(a,n)=>(r(),j(H,{to:"body"},[o(G,{ref_key:"modal",ref:v,"width-mode":"form-cols-1",onClosed:n[14]||(n[14]=e=>Object.keys(t).map(m=>t[m]=null))},{header:y(()=>[Y]),body:y(()=>[s("div",Z,[ee,o(Q,{name:"patient_type",class:"md:grid grid-cols-2 gap-4",modelValue:t.patient_type,"onUpdate:modelValue":n[0]||(n[0]=e=>t.patient_type=e),options:["Patient","Recipient with LD"],onAutosave:C},null,8,["modelValue"]),o(D,{name:"slide-fade"},{default:y(()=>[t.patient_type?(r(),l("div",te,[t.patient_type==="Patient"?(r(),l("div",ne,[o(h,{label:"patient hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":n[1]||(n[1]=e=>t.hn=e),type:"tel",error:t.patient_error,ref_key:"hnInput",ref:u,onAutosave:n[2]||(n[2]=e=>_("recipient"))},null,8,["modelValue","error"]),o(h,{label:"patient name",name:"patient_name",modelValue:t.patient_name,"onUpdate:modelValue":n[3]||(n[3]=e=>t.patient_name=e),readonly:""},null,8,["modelValue"])])):t.patient_type==="Recipient with LD"?(r(),l("div",se,[o(h,{label:"recipient hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":n[4]||(n[4]=e=>t.hn=e),type:"tel",error:t.patient_error,ref_key:"hnInput",ref:u,onAutosave:n[5]||(n[5]=e=>_("recipient"))},null,8,["modelValue","error"]),o(h,{label:"recipient name",name:"patient_name",modelValue:t.patient_name,"onUpdate:modelValue":n[6]||(n[6]=e=>t.patient_name=e),readonly:""},null,8,["modelValue"]),o(h,{label:"donor hn",name:"donor_hn",modelValue:t.donor_hn,"onUpdate:modelValue":n[7]||(n[7]=e=>t.donor_hn=e),type:"tel",error:t.donor_error,onAutosave:n[8]||(n[8]=e=>_("donor"))},null,8,["modelValue","error"]),o(h,{label:"donor name",name:"donor_name",modelValue:t.donor_name,"onUpdate:modelValue":n[9]||(n[9]=e=>t.donor_name=e),readonly:""},null,8,["modelValue"])])):V("",!0),o(J,{label:"collection date",name:"date_serum",modelValue:t.date_serum,"onUpdate:modelValue":n[10]||(n[10]=e=>t.date_serum=e)},null,8,["modelValue"]),s("div",null,[oe,s("div",ae,[o(F,{label:"HLA typing",name:"request_hla",modelValue:t.request_hla,"onUpdate:modelValue":n[11]||(n[11]=e=>t.request_hla=e)},null,8,["modelValue"]),o(F,{label:"Addition Tissue Typing",name:"request_addition_tissue",modelValue:t.request_addition_tissue,"onUpdate:modelValue":n[12]||(n[12]=e=>t.request_addition_tissue=e)},null,8,["modelValue"]),o(F,{label:"Crossmatch",name:"request_cxm",modelValue:t.request_cxm,"onUpdate:modelValue":n[13]||(n[13]=e=>t.request_cxm=e)},null,8,["modelValue"])])])])):V("",!0)]),_:1})])]),footer:y(()=>[s("div",re,[s("button",{class:"btn btn-accent",onClick:A,disabled:x($)},de,8,le)])]),_:1},512)]))}},me=["textContent"],N={__name:"NoteStatusBadge",props:{status:{type:String,required:!0}},setup(i){const p=i,d=T(()=>{switch(p.status){case"draft":case"pending":return"light";case"submitted":case"published":case"approved":return"success";case"canceled":case"deleted":return"dark";case"disapproved":case"scheduling":case"edited":return"warning";default:return"light"}});return(g,t)=>(r(),l("span",{class:L(["italic text-sm md:text-base py-1 px-2 md:px-3 rounded-2xl",{"border border-slate-200 md:border-none  md:bg-slate-200 md:text-slate-700":x(d)==="light","border border-green-400 md:border-none md:bg-green-400 md:text-white":x(d)==="success","border border-slate-700 md:border-none  md:bg-slate-700 md:text-gray-200":x(d)==="dark","border border-yellow-400 md:border-none  md:bg-yellow-400 md:text-white":x(d)==="warning"}]),textContent:c(i.status)},null,10,me))}},ce={class:"flex flex-col-reverse md:flex-row justify-between items-center mb-4"},pe={class:"bg-white rounded shadow overflow-x-auto hidden md:block"},_e={class:"w-full whitespace-nowrap"},fe={class:"text-left font-semibold text-complement"},be=["textContent","colspan"],he={key:0,class:"border-t"},ye=["textContent"],xe={class:"border-t"},ge={class:"flex justify-between items-center"},ve={class:"md:hidden"},ke={class:"flex justify-between items-center my-2 px-2"},we={class:"bg-primary-darker p-2 rounded-full"},Ve={class:"my-2 p-2 bg-gray-100 rounded space-y-2"},qe={class:"flex items-center justify-between"},Ce={class:"font-semibold text-complement text-xs flex items-center"},$e={class:"block py-2 px-1 italic truncate"},Ae={class:"flex items-center justify-between text-xs"},Fe=["textContent"],je=["textContent"],ze={__name:"ReportIndex",props:{reports:{type:Object,required:!0},configs:{type:Object,required:!0},filters:{type:Object,required:!0},routes:{type:Object,required:!0},can:{type:Object,required:!0}},setup(i){const p=i,d=R({search:p.filters.search,scope:p.filters.scope}),g=w(null),t=w(null),v=a=>{var n,e,m,f;U({patient_type:a.patient_type,hn:a.hn,date_serum:a.date_serum,request_hla:(n=a.request_hla)!=null?n:!1,request_cxm:(e=a.request_cxm)!=null?e:!1,request_addition_tissue:(m=a.request_addition_tissue)!=null?m:!1,donor_hn:(f=a.donor_hn)!=null?f:null}).post(p.routes.reportsStore)};let u=null;const _=a=>{switch(u={...a},u.name){case"destroy-report":case"cancel-report":$(u.config);break}},q=a=>{switch(u.name){case"destroy-report":case"cancel-report":U({reason:a}).delete(u.route,{onFinish:()=>u=null});break}},{confirmForm:C,openConfirmForm:$,confirmed:A}=E();return B(()=>g.value.focus()),(a,n)=>(r(),l(b,null,[s("div",ce,[o(X,{scopes:i.configs.scopes,form:d,onSearchChanged:n[0]||(n[0]=e=>d.search=e),onScopeChanged:n[1]||(n[1]=e=>d.scope=e),ref_key:"searchInput",ref:g},null,8,["scopes","form"]),i.can.create?(r(),l("button",{key:0,class:"btn btn-accent w-full mb-4 md:w-auto md:px-4 md:mb-0",onClick:n[2]||(n[2]=e=>a.$refs.createForm.open())}," New Report ")):V("",!0)]),s("div",pe,[s("table",_e,[s("tr",fe,[(r(),l(b,null,k(["HN","Patient","Request","On","Status","Author"],e=>s("th",{class:"px-6 pt-6 pb-4",key:e,textContent:c(e),colspan:e==="Author"?2:1},null,8,be)),64))]),(r(!0),l(b,null,k(i.reports.data,(e,m)=>(r(),l("tr",{class:"focus-within:bg-primary-darker",key:m},[(r(),l(b,null,k(["hn","patient_name","request","date_serum","status","author"],f=>(r(),l(b,{key:f},[f==="status"?(r(),l("td",he,[o(N,{status:e.status},null,8,["status"])])):(r(),l("td",{key:1,class:"px-6 py-4 border-t",textContent:c(e[f])},null,8,ye))],64))),64)),s("td",xe,[s("div",ge,[o(I,{actions:e.actions,onActionClicked:_},null,8,["actions"])])])]))),128))])]),s("div",ve,[(r(!0),l(b,null,k(i.reports.data,(e,m)=>(r(),l("div",{class:"bg-white rounded shadow my-4 p-4",key:m},[s("div",ke,[s("div",null," HN: "+c(e.hn)+" "+c(e.patient_name),1),e.actions.length>1?(r(),j(P,{key:0},{default:y(()=>[s("div",we,[o(M,{class:"w-4 h-4 text-accent"})])]),dropdown:y(()=>[o(z,{actions:e.actions,onActionClicked:_},null,8,["actions"])]),_:2},1024)):e.actions.length===1?(r(),j(I,{key:1,actions:e.actions,onActionClicked:_},null,8,["actions"])):V("",!0)]),s("div",Ve,[s("div",qe,[o(N,{status:e.status},null,8,["status"]),s("p",Ce,[s("span",$e,c(e.author),1)])]),s("div",Ae,[s("p",null,[S(" Serum : "),s("span",{class:"text-complement font-semibold",textContent:c(e.date_serum)},null,8,Fe)]),s("p",null,[S(" Request: "),s("span",{class:"text-complement font-semibold px-1",textContent:c(e.request)},null,8,je)])])])]))),128))]),o(W,{links:i.reports.links},null,8,["links"]),o(ue,{"service-endpoint":i.routes.patientsShow,onConfirmed:v,ref_key:"createForm",ref:t},null,8,["service-endpoint"]),o(K,{ref_key:"confirmForm",ref:C,onConfirmed:n[3]||(n[3]=e=>x(A)(e,q))},null,512)],64))}};export{ze as default};
