import{_ as B}from"./FormDatetime.f2e631b4.js";import z from"./DialysisSlot.2ab3976a.js";import{I as R,a as H,_ as L}from"./WardSlot.f0d40e8c.js";import{r as k,o,c,f as g,b as a,t as y,n as U,u as s,a as d,w as b,F as x,d as V,T as I,C as $,j as P,v as D,h as W,q as M,s as S,e as j,ac as G,I as F,ah as K,y as Q}from"./app.188a3521.js";import{t as J}from"./throttle.17d6c507.js";import{_ as T}from"./FormAutocomplete.9dfa89fd.js";import{_ as N}from"./FormSelect.86efa578.js";import{_ as X}from"./FormRadio.191fb4d9.js";import{_ as O}from"./SpinnerButton.56782f69.js";import{_ as q}from"./FormCheckbox.ada4ed44.js";import{F as Y,_ as Z}from"./FallbackSpinner.4850b28b.js";import{I as A}from"./IconUserMd.6d3771e9.js";import{p as ee}from"./pickBy.ce5eea16.js";const te={class:"relative"},ae={class:"w-full"},le=["for"],se={class:"relative"},oe=["id","name","value"],ne=a("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1),re={key:1,class:"text-red-700 mt-2 text-sm"},ie=["onClick"],de={__name:"FormAutocompleteKeyValue",props:{keyModel:{type:[String,null],default:null},valueModel:{type:[String,null],default:null},label:{type:String,default:""},endpoint:{type:String,default:""},params:{type:String,default:""},name:{type:String,required:!0},error:{type:String,default:""},lengthToStart:{type:[Number,String],default:3}},emits:["update:keyModel","update:valueModel","autosave"],setup(l,{emit:r}){const _=l,e=k([]),t=k(null),p=k(!1),u=J(function(){if(r("update:valueModel",t.value.value),r("update:keyModel",null),t.value.value.length<_.lengthToStart){p.value&&(p.value=!1),t.value.value||r("autosave");return}window.axios.get(_.endpoint+"?search="+t.value.value+_.params).then(v=>{e.value=v.data.length?v.data:[{key:"",value:"No match found"}],p.value=!0}).catch(v=>{console.log(v)})},300),m=v=>{t.value.value=v.value,p.value=!1,r("update:valueModel",v.value),r("update:keyModel",v.key),r("autosave")};return(v,w)=>(o(),c("div",te,[p.value?(o(),c("div",{key:0,class:"fixed inset-0 z-10",onClick:w[0]||(w[0]=h=>p.value=!1)})):g("",!0),a("div",ae,[l.label?(o(),c("label",{key:0,class:"form-label",for:l.name},y(l.label)+" : ",9,le)):g("",!0),a("div",se,[a("input",{type:"text",class:U(["form-input",{"border-red-400 text-red-400":l.error}]),onInput:w[1]||(w[1]=(...h)=>s(u)&&s(u)(...h)),id:l.name,name:l.name,ref_key:"input",ref:t,value:l.valueModel},null,42,oe),ne]),l.error?(o(),c("div",re,y(l.error),1)):g("",!0)]),d(I,{name:"fade-appear"},{default:b(()=>[p.value?(o(),c("div",{key:0,class:U(["absolute mt-1 bg-white rounded border-2 border-yellow-200 shadow-xl w-full max-h-44 py-2 overflow-y-scroll z-20 origin-top",{"scale-100 opacity-100":p.value}])},[(o(!0),c(x,null,V(e.value,h=>(o(),c("button",{class:"block w-full py-1 px-2 lg:px-3 hover:bg-primary hover:text-accent text-left",key:h.key,onClick:C=>m(h)},y(h.value),9,ie))),128))],2)):g("",!0)]),_:1})]))}},ue={class:"flex flex-col-reverse md:flex-row md:space-x-4"},ce={class:"space-y-2 md:w-1/2"},me=a("label",{for:"dialysis_at",class:"form-label"},"dialysis at :",-1),fe=a("label",{class:"form-label"},"patient type",-1),_e={key:0,class:"space-y-2"},pe={class:"md:w-1/2"},ye={__name:"SlotReservationForm",props:{configs:{type:Object,required:!0}},setup(l){const r=l,_=k(!1);$(()=>_.value,f=>{!f&&e.dialysis_at===r.configs.covid_ward||(e.dialysis_at=f?r.configs.hd_unit_ward:null)});const e=P({case_key:null,attending_staff:null,dialysis_type:null,patient_type:null,dialysis_at:null,covid_case:!1,case_label:null,date_note:null}),t=D({route_lab:r.configs.covid.route_lab,route_vaccine:r.configs.covid.route_vaccine,hn:null,cid:null});$(()=>e.case_key,f=>{if(!f){t.hn=null;return}let n=f.split("|");t.cid=n[2],t.hn=n[1]}),W(()=>{r.configs.case&&(e.case_key=r.configs.case.value,e.case_label=r.configs.case.label)}),$([()=>e.dialysis_type,()=>e.dialysis_at,()=>e.covid_case],()=>{u.value.length&&(u.value=[],e.date_note=null)}),$(()=>e.date_note,f=>{if(!f)return;let n=u.value.findIndex(i=>i.value===f);n!==-1&&(u.value[n].error!==void 0?e.errors.date_note=u.value[n].error:e.errors.date_note=null)});const p=()=>e.transform(f=>({...f,case_record_hashed_key:f.case_key.split("|")[0]})).post(r.configs.routes.orders_store,{preserveState:!0,onFinish:()=>{e.processing=!1}}),u=k([]),m=k(!1),v=M(()=>!e.dialysis_type||!e.dialysis_at),w=()=>{m.value=!0,window.axios.post(r.configs.routes.slot_available_dates,e.data()).then(f=>u.value=[...f.data]).catch(f=>console.log(f)).finally(()=>m.value=!1)},h=k(!1);$(()=>e.covid_case,f=>{h.value=f,f?(e.dialysis_at=r.configs.covid_ward,_.value=!1):e.dialysis_at=null});const C=M(()=>e.covid_case?r.configs.covid_dialysis:e.dialysis_at&&e.dialysis_at.search("Hemodialysis")!==-1?r.configs.in_unit_dialysis_types:r.configs.out_unit_dialysis_types);return(f,n)=>(o(),c("div",ue,[a("div",ce,[d(de,{name:"case",label:"case","key-model":s(e).case_key,"onUpdate:key-model":n[0]||(n[0]=i=>s(e).case_key=i),"value-model":s(e).case_label,"onUpdate:value-model":n[1]||(n[1]=i=>s(e).case_label=i),error:s(e).errors.case_key,endpoint:l.configs.routes.idle_cases},null,8,["key-model","value-model","error","endpoint"]),d(q,{class:"border border-dashed border-l-0 border-r-0 border-accent py-2",label:"covid-19 infected",toggler:!0,name:"covid_case",modelValue:s(e).covid_case,"onUpdate:modelValue":n[2]||(n[2]=i=>s(e).covid_case=i)},null,8,["modelValue"]),me,h.value?g("",!0):(o(),S(q,{key:0,label:l.configs.hd_unit_ward,modelValue:_.value,"onUpdate:modelValue":n[3]||(n[3]=i=>_.value=i)},null,8,["label","modelValue"])),d(I,{name:"slide-fade"},{default:b(()=>[_.value?g("",!0):(o(),S(T,{key:0,name:"dialysis_at",modelValue:s(e).dialysis_at,"onUpdate:modelValue":n[4]||(n[4]=i=>s(e).dialysis_at=i),endpoint:l.configs.routes.resources_api_wards,error:s(e).errors.dialysis_at,"length-to-start":1,disabled:h.value},null,8,["modelValue","endpoint","error","disabled"]))]),_:1}),d(N,{label:"dialysis type",name:"dialysis_type",modelValue:s(e).dialysis_type,"onUpdate:modelValue":n[5]||(n[5]=i=>s(e).dialysis_type=i),options:s(C),disabled:!s(e).dialysis_at},null,8,["modelValue","options","disabled"]),a("div",null,[fe,d(X,{class:"grid grid-cols-2 gap-x-2",name:"patient_type",modelValue:s(e).patient_type,"onUpdate:modelValue":n[6]||(n[6]=i=>s(e).patient_type=i),options:l.configs.patient_types,ref:"patientTypeInput"},null,8,["modelValue","options"])]),d(T,{label:"attending",name:"attending_staff",modelValue:s(e).attending_staff,"onUpdate:modelValue":n[7]||(n[7]=i=>s(e).attending_staff=i),endpoint:l.configs.routes.resources_api_staffs,params:l.configs.routes.staffs_scope_params,error:s(e).errors.attending_staff,"length-to-start":1},null,8,["modelValue","endpoint","params","error"]),d(O,{class:"btn btn-complement w-full",spin:m.value,disabled:s(v),onClick:w},{default:b(()=>[j(" Check available dates ")]),_:1},8,["spin","disabled"]),d(I,{name:"slide-fade"},{default:b(()=>[u.value.length?(o(),c("div",_e,[d(N,{label:"required date",name:"date_note",modelValue:s(e).date_note,"onUpdate:modelValue":n[8]||(n[8]=i=>s(e).date_note=i),options:u.value,error:s(e).errors.date_note},null,8,["modelValue","options","error"]),d(O,{class:"btn btn-accent w-full",spin:s(e).processing,disabled:Object.keys(s(e).data()).reduce((i,E)=>i||s(e)[E]===null,!1),onClick:p},{default:b(()=>{var i;return[j(y(((i=s(e).date_note)!=null?i:"").includes("Approval")?"REQUEST ":"")+" RESERVE ",1)]}),_:1},8,["spin","disabled"])])):g("",!0)]),_:1})]),a("div",pe,[d(I,{mode:"out-in"},{default:b(()=>[t.hn?(o(),S(G,{key:0},{fallback:b(()=>[d(Y)]),default:b(()=>[d(Z,{configs:t},null,8,["configs"])]),_:1})):g("",!0)]),_:1})])]))}},ve={key:0},be=a("p",{class:"mt-1 italic text-xs text-accent"}," \u0E4F Not in any particular order ",-1),ge={key:0,class:"mt-2 lg:mt-0 mb-2 md:mb-4 grid grid-cols-1 gap-2"},he={class:"mt-2 md:mt-4 form-label"},xe={class:"w=1/4"},ke={class:"w-3/4 mt-1 mt-0 space-x-2 flex items-center"},we={class:"block py-1 italic truncate underline"},$e={class:"font-semibold text-xs flex items-center"},Ve={class:"block py-1 italic truncate"},Se={class:"font-semibold text-xs flex items-center"},Ie={class:"block py-1 italic truncate"},Ue={key:1,class:"mt-1 italic text-xs text-accent"},qe={__name:"CovidSlot",props:{slots:{type:Object,required:!0}},setup(l){return(r,_)=>l.slots.in.length||l.slots.out.length?(o(),c("div",ve,[be,(o(),c(x,null,V(["in","out"],e=>a("div",{key:e},[d(K,{name:"flip-list",tag:"div"},{default:b(()=>[l.slots[e].length?(o(),c("div",ge,[a("label",he,y(e==="in"?"Acute Dialysis Unit":"Ward"),1),(o(!0),c(x,null,V(l.slots[e],(t,p)=>(o(),c("div",{class:U(["w-full p-2 md:p-4 rounded shadow",{"bg-green-400 p-4 h-8":!t.type,"flex justify-between items-center":t.type,"text-complement-darker bg-amber-400":t.status!==void 0&&t.status==="scheduling","text-primary bg-rose-900 animate-pulse":t.status!==void 0&&t.status==="started","text-primary bg-complement":t.status!==void 0&&t.status==="finished","text-primary bg-red-400":t.status!==void 0&&t.status!=="scheduling"&&t.status!=="started"&&t.status!=="finished"}]),key:p},[t.type?(o(),c(x,{key:0},[a("div",xe,[d(s(F),{href:t.order_route},{default:b(()=>[a("span",{class:U(["p-1 md:p-2 rounded-full text-xs font-semibold underline",{"bg-primary text-accent":t.status!=="submitted","bg-indigo-400 text-white":t.status==="submitted"}])},y(t.type),3)]),_:2},1032,["href"])]),a("div",ke,[d(s(F),{class:"font-semibold text-xs flex items-center",href:t.case_record_route},{default:b(()=>[t.on_ventilator?(o(),S(R,{key:0,class:"h-3 w-3 mr-1 text-green-400"})):(o(),S(H,{key:1,class:"h-3 w-3 mr-1 text-white"})),a("span",we,y(t.patient_name),1)]),_:2},1032,["href"]),a("p",$e,[d(A,{class:"h-3 w-3 mr-1 text-white"}),a("span",Ve,y(t.author),1)]),a("p",Se,[d(A,{class:"h-3 w-3 mr-1 text-white"}),a("span",Ie,y(t.attending),1)])])],64)):g("",!0)],2))),128))])):g("",!0)]),_:2},1024)])),64))])):(o(),c("p",Ue," \u0E4F No cases "))}},Ce={class:"md:flex items-end md:space-x-4"},Me=["href"],je=a("h2",{class:"mt-6 md:mt-12 xl:mt-24 form-label italic text-xl text-complement"}," Acute dialysis unit ",-1),Fe={class:"grid grid-flow-col grid-rows-1 gap-4 xl:gap-8 overflow-x-scroll pb-2 md:pb-4 border-b-2 border-dashed border-complement"},Te={class:"font-medium text-complement italic"},Ne=a("h2",{class:"mt-6 md:mt-12 xl:mt-24 form-label italic text-xl text-complement"}," Ward ",-1),Oe={class:"grid grid-flow-col grid-rows-1 gap-4 xl:gap-8 overflow-x-scroll pb-2 md:pb-4 border-b-2 border-dashed border-complement"},Ae={class:"font-medium text-complement italic"},De=a("h2",{class:"mt-6 md:mt-12 xl:mt-24 form-label italic text-xl text-complement"}," COVID cases ",-1),Ee={class:"grid grid-flow-col grid-rows-1 gap-4 xl:gap-8 overflow-x-scroll"},Be={class:"font-medium text-complement italic"},et={__name:"ScheduleIndex",props:{query:{type:Object,required:!0},slots:{type:Array,required:!0},configs:{type:Object,required:!0}},setup(l){var e,t;const r=l,_=D({ref_date:(e=r.query.ref_date)!=null?e:null,full_week:((t=r.query.full_week)!=null?t:!1)==="on"});return $(()=>_,p=>{let u=ee(p);u=Object.keys(u).length?u:{remember:"forget"},u.full_week!==void 0&&(u.full_week="on"),Q.Inertia.get(location.pathname,u,{preserveState:!0,preserveScroll:!0})},{deep:!0}),(p,u)=>(o(),c(x,null,[l.configs.can.create_order?(o(),S(ye,{key:0,class:"border-b-2 border-dashed pb-2 mb-2 md:pb-4 md:mb-4",configs:l.configs},null,8,["configs"])):g("",!0),a("div",Ce,[d(B,{label:"reference date",name:"ref_date",modelValue:_.ref_date,"onUpdate:modelValue":u[0]||(u[0]=m=>_.ref_date=m)},null,8,["modelValue"]),a("a",{class:"block mt-4 md:mt-0 w-full btn btn-complement h-10 text-center",href:l.configs.routes.orders_export}," Export excel ",8,Me)]),d(q,{class:"mt-6 md:mt-12 xl:mt-24",toggler:!0,modelValue:_.full_week,"onUpdate:modelValue":u[1]||(u[1]=m=>_.full_week=m),label:"Full week"},null,8,["modelValue"]),je,a("div",Fe,[(o(!0),c(x,null,V(l.slots,m=>(o(),c("div",{class:"w-[21rem] sm:w-[22-rem] md:w-[24rem]",key:m.date_note},[a("label",Te,y(m.date_label),1),d(z,{slots:m.hd_unit},null,8,["slots"])]))),128))]),Ne,a("div",Oe,[(o(!0),c(x,null,V(l.slots,m=>(o(),c("div",{class:"w-[21rem] sm:w-[22-rem] md:w-[24rem]",key:m.date_note},[a("label",Ae,y(m.date_label),1),d(L,{slots:m.ward},null,8,["slots"])]))),128))]),De,a("div",Ee,[(o(!0),c(x,null,V(l.slots,m=>(o(),c("div",{class:"w-[21rem] sm:w-[22-rem] md:w-[24rem]",key:m.date_note},[a("label",Be,y(m.date_label),1),d(qe,{slots:m.covid_cases},null,8,["slots"])]))),128))])],64))}};export{et as default};
