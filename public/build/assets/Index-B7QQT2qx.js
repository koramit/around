import{r as b,k as V,h as l,j as M,d as r,e as _,b as s,w as I,f as F,c as a,F as C,l as $,t as v,p as N,m as q,g as j,C as T,n as K,x as A,u as P,T as J,s as L,B as H}from"./app-hB5XZ3ER.js";import{_ as O}from"./FormInput-Dkyy63e2.js";import{M as B}from"./ModalDialog-CUOEpxmd.js";import{_ as D}from"./SpinnerButton-8OHSCgEJ.js";import{_ as R}from"./FormDatetime-BpCufAjl.js";import{_ as z}from"./NoteStatusBadge-CM0eLGoL.js";import{_ as G}from"./ActionColumn-Ckymqvzh.js";import{_ as Q}from"./PaginationNav-BLWZwRYI.js";import{_ as U}from"./SearchIndex-BofPIQ4s.js";import{_ as E}from"./FormSelect-B6PtLa0P.js";import"./pickBy-D1HfcJkn.js";import"./throttle-CEzhkIKX.js";const W={class:"py-4 my-2 md:py-6 md:my-4 border-t border-b border-accent-darker"},X={class:"bg-gray-100 text-gray-100 whitespace-nowrap"},Y={key:1,class:"bg-white rounded shadow p-2 lg:p-4 text-sm"},Z={class:"text-complement uppercase font-semibold"},ee={key:0},te={class:"flex justify-end items-center"},ne=["disabled"],se={__name:"CreateForm",props:{serviceEndpoint:{type:String,required:!0}},emits:["confirmed"],setup(c,{expose:g,emit:k}){const f=c,x=k,i=b(null),m=b(null),h=b(!1),t=V({hn:null,date_transplant:null,case_no:null}),e=V({hn:null,name:null,gender:null,age:null}),n=V({hn:null});function w(){h.value=!0,n.hn=null,Object.keys(e).map(d=>e[d]=null),window.axios.post(f.serviceEndpoint,{hn:t.hn}).then(d=>{if(!d.data.found){n.hn=d.data.message;return}Object.keys(e).map(o=>e[o]=d.data[o]??null),e.hn=t.hn}).catch(d=>{console.log(d)}).finally(()=>{h.value=!1})}function p(){i.value.open(),Object.keys(e).map(d=>e[d]=null),K(()=>m.value.focus())}function y(){t.hn=e.hn,x("confirmed",{...t}),i.value.close()}return g({open:p}),(d,o)=>(l(),M(T,{to:"body"},[r(B,{ref_key:"modal",ref:i,"width-mode":"form-cols-1",onClosed:o[3]||(o[3]=S=>Object.keys(t).map(u=>t[u]=null))},{header:_(()=>o[4]||(o[4]=[s("div",{class:"font-semibold text-complement"}," Search HN ",-1)])),body:_(()=>{var S;return[s("div",W,[r(O,{label:"hn",name:"hn",modelValue:t.hn,"onUpdate:modelValue":o[0]||(o[0]=u=>t.hn=u),type:"tel",error:n.hn,ref_key:"anInput",ref:m,onKeydown:I(w,["enter"])},null,8,["modelValue","error"]),r(D,{spin:h.value,class:"btn-complement w-full mt-2",onClick:w,disabled:!((S=t.hn)!=null&&S.length)},{default:_(()=>o[5]||(o[5]=[F(" SEARCH ")])),_:1},8,["spin","disabled"]),o[7]||(o[7]=s("hr",{class:"my-4 md:my-6"},null,-1)),o[8]||(o[8]=s("span",{class:"form-label block"},"Patient data",-1)),e.hn?(l(),a("div",Y,[(l(!0),a(C,null,$([...Object.keys(e)].filter(u=>e[u]),u=>(l(),a("p",{class:"mt-1 whitespace-nowrap",key:u},[s("span",Z,v(u.replaceAll("_"," "))+" : ",1),F(" "+v(e[u]),1)]))),128))])):(l(),a("div",{key:0,class:N(["bg-white rounded shadow p-2 lg:p-4 text-sm",{"animate-pulse":h.value}])},[(l(!0),a(C,null,$(Object.keys(e),u=>(l(),a("div",{class:"mt-1",key:u},[s("span",X,v(u)+" placeholder ",1)]))),128))],2)),r(q,{name:"slide-fade"},{default:_(()=>[e.hn?(l(),a("div",ee,[o[6]||(o[6]=s("hr",{class:"my-4 md:my-6"},null,-1)),r(R,{label:"date transplant",name:"date_transplant",modelValue:t.date_transplant,"onUpdate:modelValue":o[1]||(o[1]=u=>t.date_transplant=u)},null,8,["modelValue"]),r(O,{class:"mt-4",label:"case no",name:"case_no",modelValue:t.case_no,"onUpdate:modelValue":o[2]||(o[2]=u=>t.case_no=u),type:"tel"},null,8,["modelValue"])])):j("",!0)]),_:1})])]}),footer:_(()=>[s("div",te,[s("button",{class:"btn btn-accent",onClick:y,disabled:!e.hn||!t.date_transplant||!t.case_no}," Confirm ",8,ne)])]),_:1},512)]))}},oe={class:"py-4 my-2 md:py-6 md:my-4 border-t border-b border-accent-darker"},le={class:"flex justify-between"},ae={key:0,class:"mt-2 pl-1 font-semibold italic text-accent"},re={key:1,class:"mt-2 pl-1 font-semibold italic text-accent"},de={class:"flex justify-end items-center"},ue={__name:"UpdateByMonth",props:{url:{type:String,required:!0}},emits:["done"],setup(c,{expose:g,emit:k}){const f=c,x=b(null),i=b(0),m=b(0),h=b(null),t=b([]),e=k;A(()=>h.value,p=>{if(!p){t.value=[],i.value=0,m.value=0;return}const y=f.url.replace("month",p);window.axios.get(y).then(d=>{t.value=[...d.data]}).catch(d=>{console.log(d)})},{immediate:!0});function n(){t.value.length===m.value&&(x.value.close(),e("done")),t.value.forEach(p=>{console.log(p.url),i.value++,window.axios.post(p.url).then(y=>{console.log(y.data)}).finally(()=>{m.value++})})}function w(){x.value.open(),h.value=null}return g({open:w}),(p,y)=>(l(),M(T,{to:"body"},[r(B,{ref_key:"modal",ref:x,"width-mode":"form-cols-1"},{header:_(()=>y[1]||(y[1]=[s("div",{class:"font-semibold text-complement"}," Update all cases by month ",-1)])),body:_(()=>[s("div",oe,[r(E,{disabled:m.value&&m.value!==i.value,modelValue:h.value,"onUpdate:modelValue":y[0]||(y[0]=d=>h.value=d),name:"month",options:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},null,8,["disabled","modelValue"]),s("div",le,[t.value.length?(l(),a("p",ae,v(t.value.length)+" active cases ",1)):j("",!0),i.value?(l(),a("p",re,v(m.value)+" cases done. ",1)):j("",!0)])])]),footer:_(()=>[s("div",de,[r(D,{class:"btn btn-accent w-32",spin:i.value>0&&i.value!==m.value,disabled:t.value.length===0,onClick:n},{default:_(()=>[F(v(i.value>0&&i.value===m.value?"OK":"UPDATE"),1)]),_:1},8,["spin","disabled"])])]),_:1},512)]))}},ie={class:"flex flex-col-reverse md:flex-row justify-between items-center mb-4"},ce={class:"hidden lg:flex lg:gap-x-2"},me={class:"bg-white rounded shadow overflow-x-auto hidden md:block"},pe={class:"w-full whitespace-nowrap"},fe={class:"text-left font-semibold text-complement"},he=["textContent","colspan"],be={key:0,class:"px-6 py-4 border-t"},ye=["textContent"],_e=["textContent"],ve={class:"border-t"},ge={class:"flex justify-between items-center"},Ne={__name:"Index",props:{caseRecords:{type:Object,required:!0},configs:{type:Object,required:!0}},setup(c){const g=c,k=b(null),f=V({search:g.configs.filters.search,scope:g.configs.filters.scope,mo:g.configs.filters.mo}),x=b(null),i=b(null);function m(t){J({...t}).post(g.configs.routes.store)}const{actionStore:h}=H();return A(()=>h.value,t=>{switch(t.name){case"update-by-month":i.value.open();break;default:return}},{deep:!0}),(t,e)=>(l(),a("div",null,[s("div",ie,[r(U,{class:"lg:hidden",scopes:c.configs.scopes,form:f,onSearchChanged:e[0]||(e[0]=n=>f.search=n),onScopeChanged:e[1]||(e[1]=n=>f.scope=n),ref_key:"searchInput",ref:k},null,8,["scopes","form"]),s("div",ce,[r(U,{scopes:c.configs.scopes,form:f,onSearchChanged:e[2]||(e[2]=n=>f.search=n),onScopeChanged:e[3]||(e[3]=n=>f.scope=n),ref_key:"searchInput",ref:k},null,8,["scopes","form"]),r(E,{class:"hidden lg:block lg:w-auto",modelValue:f.mo,"onUpdate:modelValue":e[4]||(e[4]=n=>f.mo=n),name:"md",options:c.configs.month_options,placeholder:"Filter by Month"},null,8,["modelValue","options"])]),c.configs.can.create?(l(),a("button",{key:0,class:"btn btn-accent w-full mb-4 md:w-auto md:px-4 md:mb-0",onClick:e[5]||(e[5]=n=>x.value.open())}," New Case ")):j("",!0)]),s("div",me,[s("table",pe,[s("thead",null,[s("tr",fe,[(l(),a(C,null,$(["KT-NO","Date Tx","Patient","Status","Annual Cr","Last Update"],n=>s("th",{class:"px-6 pt-6 pb-4",key:n,textContent:v(n),colspan:n==="Last Update"?2:1},null,8,he)),64))])]),s("tbody",null,[(l(!0),a(C,null,$(c.caseRecords.data,(n,w)=>(l(),a("tr",{class:"focus-within:bg-primary-darker",key:w},[(l(),a(C,null,$(["kt_no","date_transplant","patient","status","annual_cr","last_update"],p=>(l(),a(C,{key:p},[p==="status"?(l(),a("td",be,[r(z,{status:n.status},null,8,["status"])])):p==="annual_cr"?(l(),a("td",{key:1,class:N(["px-6 py-4 border-t font-medium",(n.annual_cr&&parseFloat(n.annual_cr))<=4?"text-green-500":"text-red-500"]),textContent:v(n.annual_cr)},null,10,ye)):(l(),a("td",{key:2,class:"px-6 py-4 border-t",textContent:v(n[p])},null,8,_e))],64))),64)),s("td",ve,[s("div",ge,[r(G,{actions:n.actions},null,8,["actions"])])])]))),128))])])]),r(Q,{links:c.caseRecords.links},null,8,["links"]),r(se,{"service-endpoint":c.configs.routes.patients_show,ref_key:"createFormRef",ref:x,onConfirmed:m},null,8,["service-endpoint"]),r(ue,{ref_key:"updateFormRef",ref:i,url:c.configs.routes.month_cases,onDone:e[6]||(e[6]=n=>P(L).reload())},null,8,["url"])]))}};export{Ne as default};
