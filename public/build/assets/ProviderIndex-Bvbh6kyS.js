import{r as h,k as g,c as i,b as t,F as y,l as w,d as r,e as k,m as B,h as o,p as F,t as b,g as C,j,q as v,f as N,N as V}from"./app-Dy-x2ucI.js";import{_ as O}from"./FormInput-BR_dRHFf.js";import{_ as S}from"./SpinnerButton-BiWBy6fL.js";const E={class:"grid md:grid-cols-2 gap-4 md:gap-8"},I={class:"px-2 py-1 md:px-4 md:py-2 rounded-3xl bg-line-app text-white font-semibold uppercase"},L=["onClick"],M=["onClick"],G={key:0,class:"mt-2 md:mt-4"},H=["onClick"],J={key:0,class:"p-2 md:p-4 bg-primary-darker rounded-xl"},K={class:"uppercase text-complement font-semibold border-b-2 border-primary border-dashed pb-2 md:pb-4 mb-2 md:mb-4"},Q={class:"mt-2 md:mt-4 flex items-center space-x-2 md:space-x-4"},W={class:"flex items-center"},X={class:"flex items-center"},Y={key:0,class:"flex items-center"},Z={key:0,class:"p-2 md:p-4 bg-primary-darker rounded-xl"},ee={class:"uppercase text-complement font-semibold border-b-2 border-primary border-dashed pb-2 md:pb-4 mb-2 md:mb-4"},te={class:"mt-2 md:mt-4 flex items-center space-x-2 md:space-x-4"},ae={class:"flex items-center"},le={class:"flex items-center"},se={class:"flex items-center"},ie={__name:"ProviderIndex",props:{providers:{type:Array,required:!0},configs:{type:Object,required:!0}},setup(p){const T=p,_=h(!1),s=g({name:null,provider_id:null,channel_id:null,channel_secret:null,access_token_url:"https://api.line.me/oauth2/v2.1/token",auth_url:"https://access.line.me/oauth2/v2.1/authorize?response_type=code",profile_url:"https://api.line.me/v2/profile"}),f=h(!1),l=g({provider:null,name:null,channel_id:null,secret:null,basic_id:null,token:null,add_friend_base_url:"https://line.me/R/ti/p/"}),P=()=>{n.value="add",_.value=!1,f.value=!1,x.value=[],d.id=null,s.name=null,s.provider_id=null,s.channel_id=null,s.channel_secret=null,s.access_token_url="https://api.line.me/oauth2/v2.1/token",s.auth_url="https://access.line.me/oauth2/v2.1/authorize?response_type=code",s.profile_url="https://api.line.me/v2/profile",setTimeout(()=>_.value=!0,300)},x=h([]),d=g({}),A=u=>{Object.keys(u).map(e=>d[e]=u[e]),n.value="edit",_.value=!1,f.value=!1,window.axios.get(u.routes.show).then(e=>{s.name=e.data.name,s.provider_id=e.data.configs.provider_id,s.channel_id=e.data.configs.channel_id,s.channel_secret=e.data.configs.channel_secret,s.access_token_url=e.data.configs.access_token_url,s.auth_url=e.data.configs.auth_url,s.profile_url=e.data.configs.profile_url,d.routes.callbacks=e.data.routes.callbacks,x.value=[...e.data.bots],setTimeout(()=>_.value=!0,300)}).catch(e=>console.log(e))},U=()=>{c.value=!0,n.value==="add"?V.post(T.configs.routes.providers_store,s,{onFinish:()=>{c.value=!1},onSuccess:()=>{n.value="edit"}}):n.value==="edit"?V.patch(d.routes.update,s,{preserveState:!0,onFinish:()=>{c.value=!1}}):c.value=!1},q=u=>{Object.keys(u).map(e=>d[e]=u[e]),n.value="add",_.value=!1,f.value=!1,l.provider=u.name,l.name="Around Bot NS0",l.channel_id=null,l.secret=null,l.basic_id=null,l.token=null,l.add_friend_base_url="https://line.me/R/ti/p/",setTimeout(()=>f.value=!0,300)},$=g({}),z=u=>{n.value="edit",_.value=!1,f.value=!1,window.axios.get(u.routes.show).then(e=>{l.provider=d.name,l.name=e.data.name,l.channel_id=e.data.channel_id,l.secret=e.data.secret,l.basic_id=e.data.basic_id,l.token=e.data.token,l.add_friend_base_url=e.data.add_friend_base_url,Object.keys(e.data).map(a=>$[a]=e.data[a]),setTimeout(()=>f.value=!0,300)}).catch(e=>{console.log(e)})},n=h("edit"),c=h(!1),R=()=>{c.value=!0,n.value==="add"?V.post(d.routes.bots_store,l,{onFinish:()=>{c.value=!1},onSuccess:()=>{n.value="edit"}}):n.value==="edit"?V.patch($.routes.update,l,{preserveState:!0,onFinish:()=>{c.value=!1}}):c.value=!1};return(u,e)=>(o(),i("div",E,[t("div",null,[t("button",{class:"btn btn-accent w-full md:w-1/2 uppercase",onClick:P}," add provider "),(o(!0),i(y,null,w(p.providers,a=>(o(),i("div",{key:a.id,class:F(["mt-2 md:mt-4 flex items-center space-x-2 md:space-x-4 p-2 md:p-4 bg-white shadow",{"border-r-4 border-complement":a.id===d.id}])},[t("span",I,b(a.platform),1),t("span",null,b(a.name),1),t("button",{class:"underline",onClick:m=>A(a)}," edit ",8,L),t("button",{class:"underline",onClick:m=>q(a)}," add bot ",8,M)],2))),128)),r(B,{name:"slide-fade"},{default:k(()=>[x.value.length?(o(),i("div",G,[(o(!0),i(y,null,w(x.value,a=>(o(),i("div",{key:a.id,class:F(["flex items-center space-x-2 md:space-x-4 p-2 md:p-4 bg-primary-darker shadow",{"border-r-4 border-accent":a.id===$.id}])},[t("span",null,b(a.name),1),t("button",{class:"underline",onClick:m=>z(a)}," edit ",8,H)],2))),128))])):C("",!0)]),_:1})]),t("div",null,[r(B,{name:"slide-fade"},{default:k(()=>{var a;return[_.value?(o(),i("div",J,[t("h3",K,b(n.value)+" provider ",1),(o(!0),i(y,null,w(Object.keys(s),m=>(o(),j(O,{class:"mt-2 md:mt-4",label:m.replaceAll("_"," "),key:m,name:m,modelValue:s[m],"onUpdate:modelValue":D=>s[m]=D},null,8,["label","name","modelValue","onUpdate:modelValue"]))),128)),t("div",Q,[t("div",W,[e[0]||(e[0]=t("span",{class:"form-label !mb-0"},"terms",-1)),r(v,{text:p.configs.routes.terms},null,8,["text"])]),t("div",X,[e[1]||(e[1]=t("span",{class:"form-label !mb-0"},"detail",-1)),r(v,{text:`${s.name} ${p.configs.channel_detail}`},null,8,["text"])]),(a=d==null?void 0:d.routes)!=null&&a.callbacks?(o(),i("div",Y,[e[2]||(e[2]=t("span",{class:"form-label !mb-0"},"callbacks",-1)),r(v,{text:d.routes.callbacks},null,8,["text"])])):C("",!0)]),r(S,{spin:c.value,class:"mt-2 md:mt-4 btn btn-accent uppercase w-full",onClick:U},{default:k(()=>[N(b(n.value==="edit"?"update":"add"),1)]),_:1},8,["spin"])])):C("",!0)]}),_:1}),r(B,{name:"slide-fade"},{default:k(()=>[f.value?(o(),i("div",Z,[t("h3",ee,b(n.value)+" bot ",1),(o(!0),i(y,null,w(Object.keys(l),a=>(o(),j(O,{class:"mt-2 md:mt-4",label:a.replaceAll("_"," "),key:a,name:a,modelValue:l[a],"onUpdate:modelValue":m=>l[a]=m},null,8,["label","name","modelValue","onUpdate:modelValue"]))),128)),t("div",te,[t("div",ae,[e[3]||(e[3]=t("span",{class:"form-label !mb-0"},"terms",-1)),r(v,{text:p.configs.routes.terms},null,8,["text"])]),t("div",le,[e[4]||(e[4]=t("span",{class:"form-label !mb-0"},"detail",-1)),r(v,{text:`${l.name} ${p.configs.channel_detail}`},null,8,["text"])]),t("div",se,[e[5]||(e[5]=t("span",{class:"form-label !mb-0"},"webhook",-1)),r(v,{text:`${p.configs.routes.base_webhooks}${l.secret}`},null,8,["text"])])]),r(S,{spin:c.value,class:"mt-2 md:mt-4 btn btn-accent uppercase w-full",onClick:R},{default:k(()=>[N(b(n.value==="edit"?"update":"add"),1)]),_:1},8,["spin"])])):C("",!0)]),_:1})])]))}};export{ie as default};
