import{_ as B}from"./FormDatetime-Csx6TKMg.js";import D from"./DialysisSlot-C-Uq1X4L.js";import{I as z,a as R,_ as P}from"./WardSlot-DXKOZHz8.js";import{r as h,h as o,c as u,g as b,b as l,t as _,p as U,u as n,d as i,e as v,F as x,l as w,m as S,v as V,T as H,k as A,o as W,i as C,j as $,f as I,S as G,z as N,P as K,N as L}from"./app-BHxCmSTL.js";import{t as Q}from"./throttle-_rxHMDc7.js";import{_ as j}from"./FormAutocomplete-DpfhPFMJ.js";import{_ as T}from"./FormSelect-BQ4Fx2zW.js";import{_ as J}from"./FormRadio-Dpn6z1Jr.js";import{_ as F}from"./SpinnerButton-CTMW6H8m.js";import{_ as q}from"./FormCheckbox-CHyVQGuR.js";import{F as X,_ as Y}from"./FallbackSpinner-BQiWX4yq.js";import{I as O}from"./IconUserMd-CSVeDa7H.js";import{p as Z}from"./pickBy-bsbRKttS.js";const ee={class:"relative"},te={class:"w-full"},le=["for"],se={class:"relative"},ae=["id","name","value"],ne={key:1,class:"text-red-700 mt-2 text-sm"},oe=["onClick"],re={__name:"FormAutocompleteKeyValue",props:{keyModel:{type:[String,null],default:null},valueModel:{type:[String,null],default:null},label:{type:String,default:""},endpoint:{type:String,default:""},params:{type:String,default:""},name:{type:String,required:!0},error:{type:String,default:""},lengthToStart:{type:[Number,String],default:3}},emits:["update:keyModel","update:valueModel","autosave"],setup(a,{emit:f}){const m=f,e=a,t=h([]),r=h(null),p=h(!1),k=Q(function(){if(m("update:valueModel",r.value.value),m("update:keyModel",null),r.value.value.length<e.lengthToStart){p.value&&(p.value=!1),r.value.value||m("autosave");return}window.axios.get(e.endpoint+"?search="+r.value.value+e.params).then(y=>{t.value=y.data.length?y.data:[{key:"",value:"No match found"}],p.value=!0}).catch(y=>{console.log(y)})},300),M=y=>{r.value.value=y.value,p.value=!1,m("update:valueModel",y.value),m("update:keyModel",y.key),m("autosave")};return(y,g)=>(o(),u("div",ee,[p.value?(o(),u("div",{key:0,class:"fixed inset-0 z-10",onClick:g[0]||(g[0]=d=>p.value=!1)})):b("",!0),l("div",te,[a.label?(o(),u("label",{key:0,class:"form-label",for:a.name},_(a.label)+" : ",9,le)):b("",!0),l("div",se,[l("input",{type:"text",class:U(["form-input",{"border-red-400 text-red-400":a.error}]),onInput:g[1]||(g[1]=(...d)=>n(k)&&n(k)(...d)),id:a.name,name:a.name,ref_key:"input",ref:r,value:a.valueModel},null,42,ae),g[2]||(g[2]=l("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),a.error?(o(),u("div",ne,_(a.error),1)):b("",!0)]),i(S,{name:"fade-appear"},{default:v(()=>[p.value?(o(),u("div",{key:0,class:U(["absolute mt-1 bg-white rounded border-2 border-yellow-200 shadow-xl w-full max-h-44 py-2 overflow-y-scroll z-20 origin-top",{"scale-100 opacity-100":p.value}])},[(o(!0),u(x,null,w(t.value,d=>(o(),u("button",{class:"block w-full py-1 px-2 lg:px-3 hover:bg-primary hover:text-accent text-left",key:d.key,onClick:s=>M(d)},_(d.value),9,oe))),128))],2)):b("",!0)]),_:1})]))}},ie={class:"flex flex-col-reverse md:flex-row md:space-x-4"},de={class:"space-y-2 md:w-1/2"},ue={key:0,class:"space-y-2"},ce={class:"md:w-1/2"},me={__name:"SlotReservationForm",props:{configs:{type:Object,required:!0}},setup(a){const f=a,m=h(!1);V(()=>m.value,d=>{!d&&e.dialysis_at===f.configs.covid_ward||(e.dialysis_at=d?f.configs.hd_unit_ward:null)});const e=H({case_key:null,attending_staff:null,dialysis_type:null,patient_type:null,dialysis_at:null,covid_case:!1,case_label:null,date_note:null}),t=A({route_lab:f.configs.covid.route_lab,route_vaccine:f.configs.covid.route_vaccine,hn:null,cid:null});V(()=>e.case_key,d=>{if(!d){t.hn=null;return}let s=d.split("|");t.cid=s[2],t.hn=s[1]}),W(()=>{f.configs.case&&(e.case_key=f.configs.case.value,e.case_label=f.configs.case.label)}),V([()=>e.dialysis_type,()=>e.dialysis_at,()=>e.covid_case],()=>{p.value.length&&(p.value=[],e.date_note=null)}),V(()=>e.date_note,d=>{if(!d)return;let s=p.value.findIndex(c=>c.value===d);s!==-1&&(p.value[s].error!==void 0?e.errors.date_note=p.value[s].error:e.errors.date_note=null)});const r=()=>e.transform(d=>({...d,case_record_hashed_key:d.case_key.split("|")[0]})).post(f.configs.routes.orders_store,{preserveState:!0,onFinish:()=>{e.processing=!1}}),p=h([]),k=h(!1),M=C(()=>!e.dialysis_type||!e.dialysis_at),y=()=>{k.value=!0,window.axios.post(f.configs.routes.slot_available_dates,e.data()).then(d=>p.value=[...d.data]).catch(d=>console.log(d)).finally(()=>k.value=!1)},g=C(()=>e.covid_case?f.configs.covid_dialysis:e.dialysis_at&&e.dialysis_at.search("Hemodialysis")!==-1?f.configs.in_unit_dialysis_types:f.configs.out_unit_dialysis_types);return(d,s)=>(o(),u("div",ie,[l("div",de,[i(re,{name:"case",label:"case","key-model":n(e).case_key,"onUpdate:keyModel":s[0]||(s[0]=c=>n(e).case_key=c),"value-model":n(e).case_label,"onUpdate:valueModel":s[1]||(s[1]=c=>n(e).case_label=c),error:n(e).errors.case_key,endpoint:a.configs.routes.idle_cases},null,8,["key-model","value-model","error","endpoint"]),i(q,{class:"border border-dashed border-l-0 border-r-0 border-accent py-2",label:"covid-19 infected",toggler:!0,name:"covid_case",modelValue:n(e).covid_case,"onUpdate:modelValue":s[2]||(s[2]=c=>n(e).covid_case=c)},null,8,["modelValue"]),s[11]||(s[11]=l("label",{for:"dialysis_at",class:"form-label"},"dialysis at :",-1)),i(q,{label:a.configs.hd_unit_ward,modelValue:m.value,"onUpdate:modelValue":s[3]||(s[3]=c=>m.value=c)},null,8,["label","modelValue"]),i(S,{name:"slide-fade"},{default:v(()=>[m.value?b("",!0):(o(),$(j,{key:0,name:"dialysis_at",modelValue:n(e).dialysis_at,"onUpdate:modelValue":s[4]||(s[4]=c=>n(e).dialysis_at=c),endpoint:a.configs.routes.resources_api_wards,error:n(e).errors.dialysis_at,"length-to-start":1},null,8,["modelValue","endpoint","error"]))]),_:1}),i(T,{label:"dialysis type",name:"dialysis_type",modelValue:n(e).dialysis_type,"onUpdate:modelValue":s[5]||(s[5]=c=>n(e).dialysis_type=c),options:g.value,disabled:!n(e).dialysis_at},null,8,["modelValue","options","disabled"]),l("div",null,[s[9]||(s[9]=l("label",{class:"form-label"},"patient type",-1)),i(J,{class:"grid grid-cols-2 gap-x-2",name:"patient_type",modelValue:n(e).patient_type,"onUpdate:modelValue":s[6]||(s[6]=c=>n(e).patient_type=c),options:a.configs.patient_types,ref:"patientTypeInput"},null,8,["modelValue","options"])]),i(j,{label:"attending",name:"attending_staff",modelValue:n(e).attending_staff,"onUpdate:modelValue":s[7]||(s[7]=c=>n(e).attending_staff=c),endpoint:a.configs.routes.resources_api_staffs,params:a.configs.routes.staffs_scope_params,error:n(e).errors.attending_staff,"length-to-start":1},null,8,["modelValue","endpoint","params","error"]),i(F,{class:"btn btn-complement w-full",spin:k.value,disabled:M.value,onClick:y},{default:v(()=>s[10]||(s[10]=[I(" Check available dates ")])),_:1},8,["spin","disabled"]),i(S,{name:"slide-fade"},{default:v(()=>[p.value.length?(o(),u("div",ue,[i(T,{label:"required date",name:"date_note",modelValue:n(e).date_note,"onUpdate:modelValue":s[8]||(s[8]=c=>n(e).date_note=c),options:p.value,error:n(e).errors.date_note},null,8,["modelValue","options","error"]),i(F,{class:"btn btn-accent w-full",spin:n(e).processing,disabled:Object.keys(n(e).data()).reduce((c,E)=>c||n(e)[E]===null,!1),onClick:r},{default:v(()=>[I(_((n(e).date_note??"").includes("Approval")?"REQUEST ":"")+" RESERVE ",1)]),_:1},8,["spin","disabled"])])):b("",!0)]),_:1})]),l("div",ce,[i(S,{mode:"out-in"},{default:v(()=>[t.hn?(o(),$(G,{key:0},{fallback:v(()=>[i(X)]),default:v(()=>[i(Y,{configs:t},null,8,["configs"])]),_:1})):b("",!0)]),_:1})])]))}},fe={key:0},pe={key:0,class:"mt-2 lg:mt-0 mb-2 md:mb-4 grid grid-cols-1 gap-2"},_e={class:"mt-2 md:mt-4 form-label"},ye={class:"w=1/4"},ve={class:"w-3/4 mt-1 mt-0 space-x-2 flex items-center"},be={class:"block py-1 italic truncate underline"},ge={class:"font-semibold text-xs flex items-center"},xe={class:"block py-1 italic truncate"},ke={class:"font-semibold text-xs flex items-center"},he={class:"block py-1 italic truncate"},we={key:1,class:"mt-1 italic text-xs text-accent"},Ve={__name:"CovidSlot",props:{slots:{type:Object,required:!0}},setup(a){return(f,m)=>a.slots.in.length||a.slots.out.length?(o(),u("div",fe,[m[0]||(m[0]=l("p",{class:"mt-1 italic text-xs text-accent"}," ๏ Not in any particular order ",-1)),(o(),u(x,null,w(["in","out"],e=>l("div",{key:e},[i(K,{name:"flip-list",tag:"div"},{default:v(()=>[a.slots[e].length?(o(),u("div",pe,[l("label",_e,_(e==="in"?"Acute Dialysis Unit":"Ward"),1),(o(!0),u(x,null,w(a.slots[e],(t,r)=>(o(),u("div",{class:U(["w-full p-2 md:p-4 rounded shadow",{"bg-green-400 p-4 h-8":!t.type,"flex justify-between items-center":t.type,"text-complement-darker bg-amber-400":t.status!==void 0&&t.status==="scheduling","text-primary bg-rose-900 animate-pulse":t.status!==void 0&&t.status==="started","text-primary bg-complement":t.status!==void 0&&t.status==="finished","text-primary bg-red-400":t.status!==void 0&&t.status!=="scheduling"&&t.status!=="started"&&t.status!=="finished"}]),key:r},[t.type?(o(),u(x,{key:0},[l("div",ye,[i(n(N),{href:t.order_route},{default:v(()=>[l("span",{class:U(["p-1 md:p-2 rounded-full text-xs font-semibold underline",{"bg-primary text-accent":t.status!=="submitted","bg-indigo-400 text-white":t.status==="submitted"}])},_(t.type),3)]),_:2},1032,["href"])]),l("div",ve,[i(n(N),{class:"font-semibold text-xs flex items-center",href:t.case_record_route},{default:v(()=>[t.on_ventilator?(o(),$(z,{key:0,class:"h-3 w-3 mr-1 text-green-400"})):(o(),$(R,{key:1,class:"h-3 w-3 mr-1 text-white"})),l("span",be,_(t.patient_name),1)]),_:2},1032,["href"]),l("p",ge,[i(O,{class:"h-3 w-3 mr-1 text-white"}),l("span",xe,_(t.author),1)]),l("p",ke,[i(O,{class:"h-3 w-3 mr-1 text-white"}),l("span",he,_(t.attending),1)])])],64)):b("",!0)],2))),128))])):b("",!0)]),_:2},1024)])),64))])):(o(),u("p",we," ๏ No cases "))}},$e={class:"md:flex items-end md:space-x-4"},Se=["href"],Ue={class:"grid grid-flow-col grid-rows-1 gap-4 xl:gap-8 overflow-x-scroll pb-2 md:pb-4 border-b-2 border-dashed border-complement"},Me={class:"font-medium text-complement italic"},qe={class:"grid grid-flow-col grid-rows-1 gap-4 xl:gap-8 overflow-x-scroll pb-2 md:pb-4 border-b-2 border-dashed border-complement"},Ce={class:"font-medium text-complement italic"},Ie={class:"grid grid-flow-col grid-rows-1 gap-4 xl:gap-8 overflow-x-scroll"},Ne={class:"font-medium text-complement italic"},Ge={__name:"ScheduleIndex",props:{query:{type:Object,required:!0},slots:{type:Array,required:!0},configs:{type:Object,required:!0}},setup(a){const f=a,m=A({ref_date:f.query.ref_date??null,full_week:(f.query.full_week??!1)==="on"});return V(()=>m,e=>{let t=Z(e);t=Object.keys(t).length?t:{remember:"forget"},t.full_week!==void 0&&(t.full_week="on"),L.get(location.pathname,t,{preserveState:!0,preserveScroll:!0})},{deep:!0}),(e,t)=>(o(),u(x,null,[a.configs.can.create_order?(o(),$(me,{key:0,class:"border-b-2 border-dashed pb-2 mb-2 md:pb-4 md:mb-4",configs:a.configs},null,8,["configs"])):b("",!0),l("div",$e,[i(B,{label:"reference date",name:"ref_date",modelValue:m.ref_date,"onUpdate:modelValue":t[0]||(t[0]=r=>m.ref_date=r)},null,8,["modelValue"]),l("a",{class:"block mt-4 md:mt-0 w-full btn btn-complement h-10 text-center",href:a.configs.routes.orders_export}," Export excel ",8,Se)]),i(q,{class:"mt-6 md:mt-12 xl:mt-24",toggler:!0,modelValue:m.full_week,"onUpdate:modelValue":t[1]||(t[1]=r=>m.full_week=r),label:"Full week"},null,8,["modelValue"]),t[2]||(t[2]=l("h2",{class:"mt-6 md:mt-12 xl:mt-24 form-label italic text-xl text-complement"}," Acute dialysis unit ",-1)),l("div",Ue,[(o(!0),u(x,null,w(a.slots,r=>(o(),u("div",{class:"w-[21rem] sm:w-[22-rem] md:w-[24rem]",key:r.date_note},[l("label",Me,_(r.date_label),1),i(D,{slots:r.hd_unit},null,8,["slots"])]))),128))]),t[3]||(t[3]=l("h2",{class:"mt-6 md:mt-12 xl:mt-24 form-label italic text-xl text-complement"}," Ward ",-1)),l("div",qe,[(o(!0),u(x,null,w(a.slots,r=>(o(),u("div",{class:"w-[21rem] sm:w-[22-rem] md:w-[24rem]",key:r.date_note},[l("label",Ce,_(r.date_label),1),i(P,{slots:r.ward},null,8,["slots"])]))),128))]),t[4]||(t[4]=l("h2",{class:"mt-6 md:mt-12 xl:mt-24 form-label italic text-xl text-complement"}," COVID cases ",-1)),l("div",Ie,[(o(!0),u(x,null,w(a.slots,r=>(o(),u("div",{class:"w-[21rem] sm:w-[22-rem] md:w-[24rem]",key:r.date_note},[l("label",Ne,_(r.date_label),1),i(Ve,{slots:r.covid_cases},null,8,["slots"])]))),128))])],64))}};export{Ge as default};
